<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>资金流入流出预测 01-数据探索与分析 | Iyin's blog</title><meta name="description" content="数据挖掘实践（资金流入流出预测）"><meta name="keywords" content="数据挖掘实践,时序"><meta name="author" content="Iyin,yinwein@foxmail.com"><meta name="copyright" content="Iyin"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/plant.png"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="资金流入流出预测 01-数据探索与分析"><meta name="twitter:description" content="数据挖掘实践（资金流入流出预测）"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="资金流入流出预测 01-数据探索与分析"><meta property="og:url" content="http://yoursite.com/2020/08/20/2020-08-20-%E8%B5%84%E9%87%91%E6%B5%81%E5%85%A5%E6%B5%81%E5%87%BA%E9%A2%84%E6%B5%8B%EF%BC%88task1%EF%BC%89/"><meta property="og:site_name" content="Iyin's blog"><meta property="og:description" content="数据挖掘实践（资金流入流出预测）"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="canonical" href="http://yoursite.com/2020/08/20/2020-08-20-%E8%B5%84%E9%87%91%E6%B5%81%E5%85%A5%E6%B5%81%E5%87%BA%E9%A2%84%E6%B5%8B%EF%BC%88task1%EF%BC%89/"><link rel="prev" title="爬虫1&amp;2（小说下载）" href="http://yoursite.com/2020/08/22/2020-08-22-%E7%88%AC%E8%99%AB1&amp;2%EF%BC%88%E5%B0%8F%E8%AF%B4%E4%B8%8B%E8%BD%BD%EF%BC%89/"><link rel="next" title="神经网络" href="http://yoursite.com/2020/03/03/2020-03-03-unit6/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web:600&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Iyin's blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://ae01.alicdn.com/kf/Hb280d3c31450463cb3dc638bf33ca871f.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">13</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">10</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">4</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#资金流入流出预测-task1"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">资金流入流出预测 task1</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#赛题理解"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">赛题理解</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#数据探索环节"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">数据探索环节</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#数据探索"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">数据探索</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#导入工具包和数据文件"><span class="toc_mobile_items-number">1.3.1.</span> <span class="toc_mobile_items-text">导入工具包和数据文件</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#时间序列分析"><span class="toc_mobile_items-number">1.3.2.</span> <span class="toc_mobile_items-text">时间序列分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#每日特征分析"><span class="toc_mobile_items-number">1.3.3.</span> <span class="toc_mobile_items-text">每日特征分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#月份特征分析"><span class="toc_mobile_items-number">1.3.4.</span> <span class="toc_mobile_items-text">月份特征分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#具体分析8、9月中每一天的申购总量与赎回总量的差异"><span class="toc_mobile_items-number">1.3.5.</span> <span class="toc_mobile_items-text">具体分析8、9月中每一天的申购总量与赎回总量的差异</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#对于节假期的分析"><span class="toc_mobile_items-number">1.3.6.</span> <span class="toc_mobile_items-text">对于节假期的分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#分析大额交易-异常值"><span class="toc_mobile_items-number">1.3.7.</span> <span class="toc_mobile_items-text">分析大额交易 异常值</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#分析用户交易纪录表中其他变量"><span class="toc_mobile_items-number">1.3.8.</span> <span class="toc_mobile_items-text">分析用户交易纪录表中其他变量</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#对于银行及支付宝利率的分析"><span class="toc_mobile_items-number">1.3.9.</span> <span class="toc_mobile_items-text">对于银行及支付宝利率的分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#小结"><span class="toc_mobile_items-number">1.3.10.</span> <span class="toc_mobile_items-text">小结</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#分析用户信息"><span class="toc_mobile_items-number">1.3.11.</span> <span class="toc_mobile_items-text">分析用户信息</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#分析大小额用户"><span class="toc_mobile_items-number">1.3.11.1.</span> <span class="toc_mobile_items-text">分析大小额用户</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#分析用户交易频次"><span class="toc_mobile_items-number">1.3.11.2.</span> <span class="toc_mobile_items-text">分析用户交易频次</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#用户其他属性"><span class="toc_mobile_items-number">1.3.11.3.</span> <span class="toc_mobile_items-text">用户其他属性</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#其他分析"><span class="toc_mobile_items-number">1.3.12.</span> <span class="toc_mobile_items-text">其他分析</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#工具"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">工具</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#资金流入流出预测-task1"><span class="toc-number">1.</span> <span class="toc-text">资金流入流出预测 task1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#赛题理解"><span class="toc-number">1.1.</span> <span class="toc-text">赛题理解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据探索环节"><span class="toc-number">1.2.</span> <span class="toc-text">数据探索环节</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据探索"><span class="toc-number">1.3.</span> <span class="toc-text">数据探索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#导入工具包和数据文件"><span class="toc-number">1.3.1.</span> <span class="toc-text">导入工具包和数据文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#时间序列分析"><span class="toc-number">1.3.2.</span> <span class="toc-text">时间序列分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#每日特征分析"><span class="toc-number">1.3.3.</span> <span class="toc-text">每日特征分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#月份特征分析"><span class="toc-number">1.3.4.</span> <span class="toc-text">月份特征分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#具体分析8、9月中每一天的申购总量与赎回总量的差异"><span class="toc-number">1.3.5.</span> <span class="toc-text">具体分析8、9月中每一天的申购总量与赎回总量的差异</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对于节假期的分析"><span class="toc-number">1.3.6.</span> <span class="toc-text">对于节假期的分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析大额交易-异常值"><span class="toc-number">1.3.7.</span> <span class="toc-text">分析大额交易 异常值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析用户交易纪录表中其他变量"><span class="toc-number">1.3.8.</span> <span class="toc-text">分析用户交易纪录表中其他变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对于银行及支付宝利率的分析"><span class="toc-number">1.3.9.</span> <span class="toc-text">对于银行及支付宝利率的分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结"><span class="toc-number">1.3.10.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析用户信息"><span class="toc-number">1.3.11.</span> <span class="toc-text">分析用户信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分析大小额用户"><span class="toc-number">1.3.11.1.</span> <span class="toc-text">分析大小额用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析用户交易频次"><span class="toc-number">1.3.11.2.</span> <span class="toc-text">分析用户交易频次</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用户其他属性"><span class="toc-number">1.3.11.3.</span> <span class="toc-text">用户其他属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他分析"><span class="toc-number">1.3.12.</span> <span class="toc-text">其他分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#工具"><span class="toc-number">1.4.</span> <span class="toc-text">工具</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://s2.ax1x.com/2020/02/27/3aTBOx.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">资金流入流出预测 01-数据探索与分析</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-08-20<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-08-22</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E7%AB%9E%E8%B5%9B/">竞赛</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><p>参考：</p>
<ul>
<li><a href="https://tianchi.aliyun.com/competition/entrance/231573/information" target="_blank" rel="noopener">https://tianchi.aliyun.com/competition/entrance/231573/information</a></li>
<li><a href="https://github.com/ChuanyuXue/The-Purchase-and-Redemption-Forecast-Challenge-baseline" target="_blank" rel="noopener">https://github.com/ChuanyuXue/The-Purchase-and-Redemption-Forecast-Challenge-baseline</a></li>
<li><a href="https://blog.csdn.net/qq_33866063/article/details/108056554?utm_medium=distribute.pc_relevant.none-task-blog-OPENSEARCH-1.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-OPENSEARCH-1.channel_param" target="_blank" rel="noopener">https://blog.csdn.net/qq_33866063/article/details/108056554?utm_medium=distribute.pc_relevant.none-task-blog-OPENSEARCH-1.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-OPENSEARCH-1.channel_param</a></li>
</ul>
<h1 id="资金流入流出预测-task1"><a href="#资金流入流出预测-task1" class="headerlink" title="资金流入流出预测 task1"></a>资金流入流出预测 task1</h1><h2 id="赛题理解"><a href="#赛题理解" class="headerlink" title="赛题理解"></a>赛题理解</h2><ul>
<li><p>背景：在既保证资金流动性风险最小，又满足日常业务运转的情况下，精确地预测资金的流入流出情况变得尤为重要。</p>
</li>
<li><p>数据：余额宝用户的申购赎回数据（2013年7月-2014年8月；每天；2 8041位用户，284 0421条记录）等信息</p>
</li>
<li><p>任务：预测未来每日的资金流入流出情况</p>
<p><strong>利用2013年7月~2014年8月的数据，预测2014年9月每一天申购和赎回的总量</strong></p>
</li>
<li><p>评估指标：积分制</p>
</li>
</ul>
<h2 id="数据探索环节"><a href="#数据探索环节" class="headerlink" title="数据探索环节"></a>数据探索环节</h2><ul>
<li><p>时间序列图：便于观察数据特点——是否具有周期性、震荡幅度等等</p>
</li>
<li><p>数据分布可视化：直方图、密度曲线图、箱型图、小提琴图</p>
</li>
<li><p>变量间相关性分析和独立性分析</p>
<p>相关性分析：</p>
<ul>
<li><p>定类变量：</p>
<ul>
<li>定类——定类 卡方类测量</li>
</ul>
</li>
<li><p>定序变量：</p>
<ul>
<li><p>定类——定序 卡方类测量</p>
</li>
<li><p>定序——定序 Spearman相关系数、同序——异序测量</p>
</li>
</ul>
</li>
<li><p>定距变量：</p>
<ul>
<li>定类——定距 Eta系数</li>
<li>定序——定距 Spearman相关系数</li>
<li>定距——定距 Pearson相关系数</li>
</ul>
</li>
</ul>
<p>独立性分析/检验：</p>
<ul>
<li>变量间无线性相关性，可能存在非线性关联</li>
</ul>
</li>
</ul>
<h2 id="数据探索"><a href="#数据探索" class="headerlink" title="数据探索"></a>数据探索</h2><p><strong>独立性检验</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> mvtpy.mvtest <span class="keyword">import</span> mvtest</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">sample = mvtest()</span><br><span class="line"><span class="comment"># 随机生成y</span></span><br><span class="line"><span class="comment"># y必须是离散向量</span></span><br><span class="line">y = np.array(range(<span class="number">5</span>))</span><br><span class="line"><span class="comment"># 生成x</span></span><br><span class="line">x = y + np.random.normal()</span><br><span class="line"><span class="comment"># 独立性检验</span></span><br><span class="line">sample.test(x, y)</span><br></pre></td></tr></tbody></table></figure></div>


<pre><code>{'Tn': 0.8, 'p-value': [0.25, 0.5]}</code></pre><h3 id="导入工具包和数据文件"><a href="#导入工具包和数据文件" class="headerlink" title="导入工具包和数据文件"></a>导入工具包和数据文件</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span>  pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> stats</span><br><span class="line"><span class="comment">#独立性检验</span></span><br><span class="line"><span class="keyword">from</span> mvtpy.mvtest <span class="keyword">import</span> mvtest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">'ignore'</span>)</span><br></pre></td></tr></tbody></table></figure></div>

<p>导入数据</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 设置数据集路径</span></span><br><span class="line">dataset_path = <span class="string">'data/'</span></span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 用户信息表</span></span><br><span class="line">users = pd.read_csv(dataset_path+<span class="string">"user_profile_table.csv"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户申购赎回数据表</span></span><br><span class="line">data_balance = pd.read_csv(dataset_path+<span class="string">"user_balance_table.csv"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收益率表</span></span><br><span class="line">share = pd.read_csv(dataset_path+<span class="string">"mfd_day_share_interest.csv"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上海银行间同业拆放利率（Shibor）表</span></span><br><span class="line">bank = pd.read_csv(dataset_path+<span class="string">"mfd_bank_shibor.csv"</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">print(<span class="string">'用户信息表'</span>)</span><br><span class="line">print(users.head(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">print(<span class="string">'用户申购赎回数据表'</span>)</span><br><span class="line">print(data_balance.head(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">print(<span class="string">'收益率表'</span>)</span><br><span class="line">print(share.head(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">print(<span class="string">'上海银行间同业拆放利率（Shibor）表'</span>)</span><br><span class="line">print(bank.head(<span class="number">3</span>))</span><br></pre></td></tr></tbody></table></figure></div>

<pre><code>用户信息表
   user_id  sex     city constellation
0        2    1  6411949           狮子座
1       12    1  6412149           摩羯座
2       22    1  6411949           双子座
用户申购赎回数据表
   user_id  report_date  tBalance  yBalance  total_purchase_amt  \
0        1     20140805     20385     20383                   2   
1        1     20140808     20391     20389                   2   
2        1     20140811     20397     20395                   2   

   direct_purchase_amt  purchase_bal_amt  purchase_bank_amt  total_redeem_amt  \
0                    0                 0                  0                 0   
1                    0                 0                  0                 0   
2                    0                 0                  0                 0   

   consume_amt  transfer_amt  tftobal_amt  tftocard_amt  share_amt  category1  \
0            0             0            0             0          2        NaN   
1            0             0            0             0          2        NaN   
2            0             0            0             0          2        NaN   

   category2  category3  category4  
0        NaN        NaN        NaN  
1        NaN        NaN        NaN  
2        NaN        NaN        NaN  
收益率表
   mfd_date  mfd_daily_yield  mfd_7daily_yield
0  20130701           1.5787             6.307
1  20130702           1.5461             6.174
2  20130703           1.4670             6.034
上海银行间同业拆放利率（Shibor）表
   mfd_date  Interest_O_N  Interest_1_W  Interest_2_W  Interest_1_M  \
0  20130701         4.456         5.423         6.040          6.88   
1  20130702         3.786         4.750         5.074          5.80   
2  20130703         3.400         4.242         4.658          5.20   

   Interest_3_M  Interest_6_M  Interest_9_M  Interest_1_Y  
0         5.295        4.2390        4.2820        4.4125  
1         5.211        4.2344        4.2808        4.4070  
2         5.148        4.2300        4.2796        4.4022  </code></pre><p><strong>添加时间信息</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data_balance[<span class="string">'report_date'</span>]</span><br></pre></td></tr></tbody></table></figure></div>


<pre><code>0          20140805
1          20140808
2          20140811
3          20140814
4          20140817
             ...   
2840416    20140825
2840417    20140831
2840418    20140724
2840419    20140727
2840420    20140305
Name: report_date, Length: 2840421, dtype: int64</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 为数据添加时间戳</span></span><br><span class="line"><span class="comment"># 需要周几信息</span></span><br><span class="line">data_balance[<span class="string">'date'</span>] = pd.to_datetime(data_balance[<span class="string">'report_date'</span>], format= <span class="string">"%Y%m%d"</span>)</span><br><span class="line">data_balance[<span class="string">'day'</span>] = data_balance[<span class="string">'date'</span>].dt.day</span><br><span class="line">data_balance[<span class="string">'month'</span>] = data_balance[<span class="string">'date'</span>].dt.month</span><br><span class="line">data_balance[<span class="string">'year'</span>] = data_balance[<span class="string">'date'</span>].dt.year</span><br><span class="line">data_balance[<span class="string">'week'</span>] = data_balance[<span class="string">'date'</span>].dt.week</span><br><span class="line">data_balance[<span class="string">'weekday'</span>] = data_balance[<span class="string">'date'</span>].dt.weekday</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">print(data_balance.head(<span class="number">2</span>))</span><br></pre></td></tr></tbody></table></figure></div>

<pre><code>   user_id  report_date  tBalance  yBalance  total_purchase_amt  \
0        1     20140805     20385     20383                   2   
1        1     20140808     20391     20389                   2   

   direct_purchase_amt  purchase_bal_amt  purchase_bank_amt  total_redeem_amt  \
0                    0                 0                  0                 0   
1                    0                 0                  0                 0   

   consume_amt  ...  category1  category2  category3  category4       date  \
0            0  ...        NaN        NaN        NaN        NaN 2014-08-05   
1            0  ...        NaN        NaN        NaN        NaN 2014-08-08   

   day  month  year week  weekday  
0    5      8  2014   32        1  
1    8      8  2014   32        4  

[2 rows x 24 columns]</code></pre><h3 id="时间序列分析"><a href="#时间序列分析" class="headerlink" title="时间序列分析"></a>时间序列分析</h3><p>聚合时间数据，得到y值。<br>每天的申购总量和赎回总量</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 统计每天申购总量和赎回总量</span></span><br><span class="line">total_balance = data_balance.groupby([<span class="string">'date'</span>])[<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>].sum()</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">print(total_balance.head(<span class="number">10</span>))</span><br></pre></td></tr></tbody></table></figure></div>

<pre><code>            total_purchase_amt  total_redeem_amt
date                                            
2013-07-01            32488348           5525022
2013-07-02            29037390           2554548
2013-07-03            27270770           5953867
2013-07-04            18321185           6410729
2013-07-05            11648749           2763587
2013-07-06            36751272           1616635
2013-07-07             8962232           3982735
2013-07-08            57258266           8347729
2013-07-09            26798941           3473059
2013-07-10            30696506           2597169</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 删除原行索引，建立索引</span></span><br><span class="line">total_balance.reset_index(inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 或者# 聚合时间数据</span></span><br><span class="line"></span><br><span class="line">total_balance = data_balance.groupby([<span class="string">'date'</span>])[<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>].sum().reset_index()</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">print(total_balance.head(<span class="number">2</span>))</span><br><span class="line">print(total_balance.head(<span class="number">-1</span>))</span><br></pre></td></tr></tbody></table></figure></div>

<pre><code>        date  total_purchase_amt  total_redeem_amt
0 2013-07-01            32488348           5525022
1 2013-07-02            29037390           2554548
          date  total_purchase_amt  total_redeem_amt
0   2013-07-01            32488348           5525022
1   2013-07-02            29037390           2554548
2   2013-07-03            27270770           5953867
3   2013-07-04            18321185           6410729
4   2013-07-05            11648749           2763587
..         ...                 ...               ...
421 2014-08-26           306945089         285478563
422 2014-08-27           302194801         468164147
423 2014-08-28           245082751         297893861
424 2014-08-29           267554713         273756380
425 2014-08-30           199708772         196374134

[426 rows x 3 columns]</code></pre><p>画出每日总购买与赎回量的时间序列图</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">fig = plt.figure(figsize=(<span class="number">20</span>,<span class="number">6</span>))</span><br><span class="line">plt.plot(total_balance[<span class="string">'date'</span>], total_balance[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'purchase'</span>)</span><br><span class="line">plt.plot(total_balance[<span class="string">'date'</span>], total_balance[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'redeem'</span>)</span><br><span class="line"></span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The lineplot of total amount of Purchase and Redeem from 7.1 to 8.30"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt="png" data-src="/images/output_20_0.png" src="/img/loading.gif" class="lazyload"></p>
<p>由上图可以看出，4月以后趋于规律，截取2014年4月份以后的时序图观察</p>
<ul>
<li>可以观察到大体以星期为周期</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出4月份以后的时间序列图</span></span><br><span class="line">total_balance_1 = total_balance[total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">1</span>)]</span><br><span class="line">fig = plt.figure(figsize=(<span class="number">20</span>,<span class="number">6</span>))</span><br><span class="line">plt.plot(total_balance_1[<span class="string">'date'</span>], total_balance_1[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'purchase'</span>)</span><br><span class="line">plt.plot(total_balance_1[<span class="string">'date'</span>], total_balance_1[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'redeem'</span>)</span><br><span class="line"></span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The lineplot of total amount of Purchase and Redeem from 2014.4 to 2014.9"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_22_0.png" src="/img/loading.gif" class="lazyload"></p>
<p>画出每个月的时间序列图，进一步观察每个星期的曲线波动情况</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 分别画出每个月中每天购买赎回量的时间序列图</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">15</span>,<span class="number">15</span>))</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">4</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of total amount of Purchase and Redeem for August, July, June, May respectively"</span>)</span><br><span class="line"></span><br><span class="line">total_balance_2 = total_balance[total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">8</span>,<span class="number">1</span>)]</span><br><span class="line">plt.plot(total_balance_2[<span class="string">'date'</span>], total_balance_2[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'purchase'</span>)</span><br><span class="line">plt.plot(total_balance_2[<span class="string">'date'</span>], total_balance_2[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'redeem'</span>)</span><br><span class="line"><span class="comment"># 添加图例</span></span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">total_balance_3 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">7</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,<span class="number">8</span>,<span class="number">1</span>))]</span><br><span class="line">plt.subplot(<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">plt.plot(total_balance_3[<span class="string">'date'</span>], total_balance_3[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'purchase'</span>)</span><br><span class="line">plt.plot(total_balance_3[<span class="string">'date'</span>], total_balance_3[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'redeem'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">total_balance_4 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">6</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,<span class="number">7</span>,<span class="number">1</span>))]</span><br><span class="line">plt.subplot(<span class="number">4</span>,<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">plt.plot(total_balance_4[<span class="string">'date'</span>], total_balance_4[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'purchase'</span>)</span><br><span class="line">plt.plot(total_balance_4[<span class="string">'date'</span>], total_balance_4[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'redeem'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">total_balance_5 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">5</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,<span class="number">6</span>,<span class="number">1</span>))]</span><br><span class="line">plt.subplot(<span class="number">4</span>,<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line">plt.plot(total_balance_5[<span class="string">'date'</span>], total_balance_5[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'purchase'</span>)</span><br><span class="line">plt.plot(total_balance_5[<span class="string">'date'</span>], total_balance_5[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'redeem'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_24_0.png" src="/img/loading.gif" class="lazyload"></p>
<ul>
<li>月末时赎回高于购买（月末时更需要钱）</li>
<li>申购与赎回看起来有关联</li>
<li>每月大概有4个波峰、4个波谷</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 分别画出13年8月与9月每日购买赎回量的时序图</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">15</span>,<span class="number">9</span>))</span><br><span class="line"></span><br><span class="line">total_balance_last8 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,<span class="number">8</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,<span class="number">9</span>,<span class="number">1</span>))]</span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">plt.plot(total_balance_last8[<span class="string">'date'</span>], total_balance_last8[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'purchase'</span>)</span><br><span class="line">plt.plot(total_balance_last8[<span class="string">'date'</span>], total_balance_last8[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'redeem'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">total_balance_last9 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,<span class="number">9</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,<span class="number">10</span>,<span class="number">1</span>))]</span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">plt.plot(total_balance_last9[<span class="string">'date'</span>], total_balance_last9[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'purchase'</span>)</span><br><span class="line">plt.plot(total_balance_last9[<span class="string">'date'</span>], total_balance_last9[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'redeem'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_26_0.png" src="/img/loading.gif" class="lazyload"></p>
<h3 id="每日特征分析"><a href="#每日特征分析" class="headerlink" title="每日特征分析"></a>每日特征分析</h3><ul>
<li>选取每天的数据进行统计分析，包括小提琴图、正态分布图、中位数特征、箱型图等；</li>
<li>最后采用斯皮尔曼相关性对数据与购买量及赎回量进行相关性分析。</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance_1[<span class="string">'weekday'</span>] = total_balance_1[<span class="string">'date'</span>].dt.weekday</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">print(total_balance_1.head(<span class="number">10</span>))</span><br></pre></td></tr></tbody></table></figure></div>

<pre><code>          date  total_purchase_amt  total_redeem_amt  weekday
274 2014-04-01           453320585         277429358        1
275 2014-04-02           355347118         272612066        2
276 2014-04-03           363877120         266605457        3
277 2014-04-04           251895894         200192637        4
278 2014-04-05           202336542         163199682        5
279 2014-04-06           129477254         139576683        6
280 2014-04-07           196936223         176966561        0
281 2014-04-08           354770149         250015131        1
282 2014-04-09           383347565         289330278        2
283 2014-04-10           386567460         286914864        3</code></pre><p>在seaborn中最简便查看单元分布的函数是distplot().该函数默认绘制直方图并拟合内核密度估计。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出4月1日以后，每个翌日的数据分布于整体数据的分布图</span></span><br><span class="line">a = plt.figure(figsize=(<span class="number">10</span>,<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#控制散点图和直线的参数</span></span><br><span class="line">scatter_para = {<span class="string">'marker'</span>:<span class="string">'.'</span>, <span class="string">'s'</span>:<span class="number">3</span>, <span class="string">'alpha'</span>:<span class="number">0.3</span>}</span><br><span class="line">line_kws = {<span class="string">'color'</span>:<span class="string">'k'</span>}</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">'The distrubution of total purchase'</span>)</span><br><span class="line">sns.violinplot(x=<span class="string">'weekday'</span>, y=<span class="string">'total_purchase_amt'</span>, data = total_balance_1, scatter_kws=scatter_para, line_kws=line_kws)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">plt.title(<span class="string">'The distrubution of total purchase'</span>)</span><br><span class="line">sns.distplot(total_balance_1[<span class="string">'total_purchase_amt'</span>].dropna())</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">plt.title(<span class="string">'The distrubution of total redeem'</span>)</span><br><span class="line">sns.violinplot(x=<span class="string">'weekday'</span>, y=<span class="string">'total_redeem_amt'</span>, data = total_balance_1, scatter_kws=scatter_para, line_kws=line_kws)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line">plt.title(<span class="string">'The distrubution of total redeem'</span>)</span><br><span class="line">sns.distplot(total_balance_1[<span class="string">'total_redeem_amt'</span>].dropna())</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_31_0.png" src="/img/loading.gif" class="lazyload"></p>
<p>与余额宝计算收益方式有关：</p>
<ul>
<li>周六、日、一转入均为周二确认购入，因此1处显示的购入最高；周三显示收益，因此2处人们得到收益之后赎回可能更多。</li>
<li>同理，周六、日的购入显示与赎回也相对较少</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 按周几对数据聚合后取均值</span></span><br><span class="line">week_sta = total_balance_1[[<span class="string">'total_purchase_amt'</span>, <span class="string">'total_redeem_amt'</span>, <span class="string">'weekday'</span>]].groupby(<span class="string">'weekday'</span>, as_index=<span class="literal">False</span>).mean()</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">print(week_sta)</span><br></pre></td></tr></tbody></table></figure></div>

<pre><code>   weekday  total_purchase_amt  total_redeem_amt
0        0        3.075183e+08      3.268733e+08
1        1        3.173125e+08      3.138971e+08
2        2        3.133103e+08      3.076354e+08
3        3        3.019386e+08      2.763898e+08
4        4        2.398712e+08      2.591565e+08
5        5        1.837682e+08      1.855464e+08
6        6        1.884616e+08      1.980553e+08</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 按周几对数据聚合后取中位数值</span></span><br><span class="line">week_sta1 = total_balance_1[[<span class="string">'total_purchase_amt'</span>, <span class="string">'total_redeem_amt'</span>, <span class="string">'weekday'</span>]].groupby(<span class="string">'weekday'</span>, as_index=<span class="literal">False</span>).median()</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">print(week_sta1)</span><br></pre></td></tr></tbody></table></figure></div>

<pre><code>   weekday  total_purchase_amt  total_redeem_amt
0        0         324937272.0       312413411.0
1        1         302997322.0       300835064.0
2        2         303834661.5       282091284.5
3        3         305630866.0       275190939.0
4        4         238565132.5       257707824.5
5        5         177821764.5       163405695.0
6        6         175137350.5       176698779.0</code></pre><p>求均值、中位数后绘制柱状图</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pylab <span class="keyword">import</span> mpl</span><br><span class="line">mpl.rcParams[<span class="string">'font.sans-serif'</span>] = [<span class="string">'FangSong'</span>] <span class="comment"># 指定默认字体</span></span><br><span class="line">mpl.rcParams[<span class="string">'axes.unicode_minus'</span>] = <span class="literal">False</span> <span class="comment"># 解决保存图像是负号'-'显示为方块的问题</span></span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">12</span>, <span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">'均值'</span>)</span><br><span class="line">ax = sns.barplot(x=<span class="string">"weekday"</span>, y=<span class="string">"total_purchase_amt"</span>, data=week_sta, label=<span class="string">'Purchase'</span>)</span><br><span class="line">ax.legend()</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">plt.title(<span class="string">'均值'</span>)</span><br><span class="line">ax = sns.barplot(x=<span class="string">"weekday"</span>, y=<span class="string">"total_redeem_amt"</span>, data=week_sta, label=<span class="string">'Redeem'</span>)</span><br><span class="line">ax.legend()</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">plt.title(<span class="string">'中位数'</span>)</span><br><span class="line">ax = sns.barplot(x=<span class="string">"weekday"</span>, y=<span class="string">"total_purchase_amt"</span>, data=week_sta1, label=<span class="string">'Purchase'</span>)</span><br><span class="line">ax.legend()</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line">plt.title(<span class="string">'中位数'</span>)</span><br><span class="line">ax = sns.barplot(x=<span class="string">"weekday"</span>, y=<span class="string">"total_redeem_amt"</span>, data=week_sta1, label=<span class="string">'Redeem'</span>)</span><br><span class="line">ax.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_39_0.png" src="/img/loading.gif" class="lazyload"></p>
<p>箱型图</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">12</span>, <span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">'The boxplot of total purchase with each weekday'</span>)</span><br><span class="line">ax = sns.boxplot(x=<span class="string">"weekday"</span>, y=<span class="string">"total_purchase_amt"</span>, data=total_balance_1)</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">plt.title(<span class="string">'The boxplot of total redeem with each weekday'</span>)</span><br><span class="line">ax = sns.boxplot(x=<span class="string">"weekday"</span>, y=<span class="string">"total_redeem_amt"</span>, data=total_balance_1)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_41_0.png" src="/img/loading.gif" class="lazyload"></p>
<p><strong>相关性与独立性分析</strong></p>
<p>对weekday进行one-hot编码生成特征</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance[<span class="string">'weekday'</span>] = total_balance[<span class="string">'date'</span>].dt.weekday</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> OneHotEncoder</span><br><span class="line">encoder = OneHotEncoder()</span><br><span class="line"></span><br><span class="line"><span class="comment">#total_balance = total_balance.reset_index()</span></span><br><span class="line"><span class="comment"># reshape 1列 编码</span></span><br><span class="line">week_feature = encoder.fit_transform(np.array(total_balance[<span class="string">'weekday'</span>]).reshape(<span class="number">-1</span>, <span class="number">1</span>)).toarray()</span><br><span class="line">print(week_feature[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成n个特征</span></span><br><span class="line">week_feature = pd.DataFrame(week_feature,columns=[<span class="string">'weekday_onehot'</span>]*len(week_feature[<span class="number">0</span>]))</span><br><span class="line">print(week_feature)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将生成的特征与原特征拼接</span></span><br><span class="line">feature = pd.concat([total_balance, week_feature], axis = <span class="number">1</span>)[[<span class="string">'total_purchase_amt'</span>, <span class="string">'total_redeem_amt'</span>,<span class="string">'weekday_onehot'</span>,<span class="string">'date'</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为每一列命名</span></span><br><span class="line">print(feature.columns[<span class="number">2</span>:<span class="number">-1</span>])</span><br><span class="line">feature.columns = list(feature.columns[<span class="number">0</span>:<span class="number">2</span>]) + [x+str(i) <span class="keyword">for</span> i,x <span class="keyword">in</span> enumerate(feature.columns[<span class="number">2</span>:<span class="number">-1</span>])] + [<span class="string">'date'</span>]</span><br></pre></td></tr></tbody></table></figure></div>

<pre><code>[1. 0. 0. 0. 0. 0. 0.]
     weekday_onehot  weekday_onehot  weekday_onehot  weekday_onehot  \
0               1.0             0.0             0.0             0.0   
1               0.0             1.0             0.0             0.0   
2               0.0             0.0             1.0             0.0   
3               0.0             0.0             0.0             1.0   
4               0.0             0.0             0.0             0.0   
..              ...             ...             ...             ...   
422             0.0             0.0             1.0             0.0   
423             0.0             0.0             0.0             1.0   
424             0.0             0.0             0.0             0.0   
425             0.0             0.0             0.0             0.0   
426             0.0             0.0             0.0             0.0   

     weekday_onehot  weekday_onehot  weekday_onehot  
0               0.0             0.0             0.0  
1               0.0             0.0             0.0  
2               0.0             0.0             0.0  
3               0.0             0.0             0.0  
4               1.0             0.0             0.0  
..              ...             ...             ...  
422             0.0             0.0             0.0  
423             0.0             0.0             0.0  
424             1.0             0.0             0.0  
425             0.0             1.0             0.0  
426             0.0             0.0             1.0  

[427 rows x 7 columns]
Index(['weekday_onehot', 'weekday_onehot', 'weekday_onehot', 'weekday_onehot',
       'weekday_onehot', 'weekday_onehot', 'weekday_onehot'],
      dtype='object')</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出划分后weekday特征与申购、赎回的斯皮尔曼相关性</span></span><br><span class="line"></span><br><span class="line">f, ax = plt.subplots(figsize = (<span class="number">15</span>, <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">'The spearman coleration between total purchase and each weekday'</span>)</span><br><span class="line">sns.heatmap(feature[[x <span class="keyword">for</span> x <span class="keyword">in</span> feature.columns <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'total_redeem_amt'</span>, <span class="string">'date'</span>] ]].corr(<span class="string">'spearman'</span>),linewidths = <span class="number">0.1</span>, vmax = <span class="number">0.2</span>, vmin=<span class="number">-0.2</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">plt.title(<span class="string">'The spearman coleration between total redeem and each weekday'</span>)</span><br><span class="line">sns.heatmap(feature[[x <span class="keyword">for</span> x <span class="keyword">in</span> feature.columns <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'total_purchase_amt'</span>, <span class="string">'date'</span>] ]].corr(<span class="string">'spearman'</span>),linewidths = <span class="number">0.1</span>,  vmax = <span class="number">0.2</span>, vmin=<span class="number">-0.2</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_46_0.png" src="/img/loading.gif" class="lazyload"></p>
<p>相关性较弱</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 定序与定距变量</span></span><br><span class="line"><span class="comment"># 进行独立性检验</span></span><br><span class="line"><span class="keyword">from</span> mvtpy.mvtest <span class="keyword">import</span> mvtest</span><br><span class="line">mv = mvtest()</span><br><span class="line">mv.test(total_balance_1[<span class="string">'total_purchase_amt'</span>], total_balance_1[<span class="string">'weekday'</span>])</span><br></pre></td></tr></tbody></table></figure></div>


<pre><code>{'Tn': 9.29, 'p-value': [0, 0.01]}</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 定序与定距变量</span></span><br><span class="line"><span class="comment"># 进行独立性检验</span></span><br><span class="line"><span class="keyword">from</span> mvtpy.mvtest <span class="keyword">import</span> mvtest</span><br><span class="line">mv = mvtest()</span><br><span class="line">mv.test(total_balance_1[<span class="string">'total_redeem_amt'</span>], total_balance_1[<span class="string">'weekday'</span>])</span><br></pre></td></tr></tbody></table></figure></div>


<pre><code>{'Tn': 7.35, 'p-value': [0, 0.01]}</code></pre><p>两个变量有0到0.01的概率独立，说明周几与申购和赎回之间存在关联</p>
<h3 id="月份特征分析"><a href="#月份特征分析" class="headerlink" title="月份特征分析"></a>月份特征分析</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出每个月的购买总量分布估计图(kdeplot)</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>,<span class="number">10</span>))</span><br><span class="line">plt.title(<span class="string">'The Probability Density of total purchase amount in Each Month'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Probability'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Amount'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>, <span class="number">12</span>):</span><br><span class="line">    sns.kdeplot(total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,i,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,i+<span class="number">1</span>,<span class="number">1</span>))][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'13Y,'</span>+str(i)+<span class="string">'M'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">9</span>):</span><br><span class="line">    sns.kdeplot(total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,i,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,i+<span class="number">1</span>,<span class="number">1</span>))][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'14Y,'</span>+str(i)+<span class="string">'M'</span>)</span><br><span class="line">    </span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_52_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出每个月的赎回总量分布估计图(kdeplot)</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>,<span class="number">10</span>))</span><br><span class="line">plt.title(<span class="string">'The Probability Density of total purchase amount in Each Month'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Probability'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Amount'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>, <span class="number">12</span>):</span><br><span class="line">    sns.kdeplot(total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,i,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,i+<span class="number">1</span>,<span class="number">1</span>))][<span class="string">'total_redeem_amt'</span>],label=<span class="string">'13Y,'</span>+str(i)+<span class="string">'M'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">9</span>):</span><br><span class="line">    sns.kdeplot(total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,i,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,i+<span class="number">1</span>,<span class="number">1</span>))][<span class="string">'total_redeem_amt'</span>],label=<span class="string">'14Y,'</span>+str(i)+<span class="string">'M'</span>)</span><br><span class="line">    </span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_53_0.png" src="/img/loading.gif" class="lazyload"></p>
<p>13年7-11月与其他月份差异明显</p>
<p>分析预测月9月相关的几月的数据</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出14年五六七八月份的分布估计图</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">'The Probability Density of total purchase and redeem amount from May.14 to August.14'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Probability'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Amount'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_2[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'August'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_3[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'July'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_4[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'June'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_5[<span class="string">'total_purchase_amt'</span>],color=<span class="string">'Black'</span>,label=<span class="string">'May'</span>)</span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Probability'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Amount'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_2[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'August'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_3[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'July'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_4[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'June'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_5[<span class="string">'total_redeem_amt'</span>],color=<span class="string">'Black'</span>,label=<span class="string">'May'</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_56_0.png" src="/img/loading.gif" class="lazyload"></p>
<p>7、8月略高</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出13年7-11月份的分布估计图</span></span><br><span class="line"></span><br><span class="line">total_balance_last_7 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,<span class="number">7</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,<span class="number">8</span>,<span class="number">1</span>))]</span><br><span class="line">total_balance_last_8 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,<span class="number">8</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,<span class="number">9</span>,<span class="number">1</span>))]</span><br><span class="line">total_balance_last_9 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,<span class="number">9</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,<span class="number">10</span>,<span class="number">1</span>))]</span><br><span class="line">total_balance_last_10 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,<span class="number">10</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,<span class="number">11</span>,<span class="number">1</span>))]</span><br><span class="line">total_balance_last_11 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,<span class="number">11</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,<span class="number">12</span>,<span class="number">1</span>))]</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">10</span>))</span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">'The Probability Density of total purchase and redeem amount from Aug.13 to Sep.13'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Probability'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Amount'</span>)</span><br><span class="line"></span><br><span class="line">ax = sns.kdeplot(total_balance_last_7[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'7'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_last_8[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'8'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_last_9[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'9'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_last_10[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'10'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_last_11[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'11'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Probability'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Amount'</span>)</span><br><span class="line"></span><br><span class="line">ax = sns.kdeplot(total_balance_last_7[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'7'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_last_8[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'8'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_last_9[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'9'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_last_10[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'10'</span>)</span><br><span class="line">ax = sns.kdeplot(total_balance_last_11[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'11'</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_58_0.png" src="/img/loading.gif" class="lazyload"></p>
<ul>
<li>7、8、9月申购量较高，8月9月申购差异较大</li>
<li>9、10月赎回量接近，比7、8月明显降低，且呈现下降趋势</li>
</ul>
<h3 id="具体分析8、9月中每一天的申购总量与赎回总量的差异"><a href="#具体分析8、9月中每一天的申购总量与赎回总量的差异" class="headerlink" title="具体分析8、9月中每一天的申购总量与赎回总量的差异"></a>具体分析8、9月中每一天的申购总量与赎回总量的差异</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance_2.head(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>total_purchase_amt</th>
      <th>total_redeem_amt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>396</th>
      <td>2014-08-01</td>
      <td>374884735</td>
      <td>252540858</td>
    </tr>
    <tr>
      <th>397</th>
      <td>2014-08-02</td>
      <td>189092130</td>
      <td>172250225</td>
    </tr>
    <tr>
      <th>398</th>
      <td>2014-08-03</td>
      <td>173825397</td>
      <td>127125217</td>
    </tr>
    <tr>
      <th>399</th>
      <td>2014-08-04</td>
      <td>330640884</td>
      <td>322907524</td>
    </tr>
    <tr>
      <th>400</th>
      <td>2014-08-05</td>
      <td>394780870</td>
      <td>221706539</td>
    </tr>
  </tbody>
</table>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance_2[<span class="string">'day'</span>] = total_balance_2[<span class="string">'date'</span>].dt.day</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 按照每天聚合数据集</span></span><br><span class="line">day_sta = total_balance_2[[<span class="string">'total_purchase_amt'</span>, <span class="string">'total_redeem_amt'</span>, <span class="string">'day'</span>]].groupby(<span class="string">'day'</span>, as_index=<span class="literal">False</span>).mean()</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance_2.head(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>total_purchase_amt</th>
      <th>total_redeem_amt</th>
      <th>day</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>396</th>
      <td>2014-08-01</td>
      <td>374884735</td>
      <td>252540858</td>
      <td>1</td>
    </tr>
    <tr>
      <th>397</th>
      <td>2014-08-02</td>
      <td>189092130</td>
      <td>172250225</td>
      <td>2</td>
    </tr>
    <tr>
      <th>398</th>
      <td>2014-08-03</td>
      <td>173825397</td>
      <td>127125217</td>
      <td>3</td>
    </tr>
    <tr>
      <th>399</th>
      <td>2014-08-04</td>
      <td>330640884</td>
      <td>322907524</td>
      <td>4</td>
    </tr>
    <tr>
      <th>400</th>
      <td>2014-08-05</td>
      <td>394780870</td>
      <td>221706539</td>
      <td>5</td>
    </tr>
  </tbody>
</table>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 获取聚合后每月购买分布的柱状图</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>,<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">ax = sns.barplot(x=<span class="string">"day"</span>, y=<span class="string">"total_purchase_amt"</span>, data=day_sta, label=<span class="string">'Purchase'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"day"</span>, y=<span class="string">"total_purchase_amt"</span>, data=day_sta, label=<span class="string">'Purchase'</span>)</span><br><span class="line">ax.legend()</span><br><span class="line">plt.title(<span class="string">"The total Purchase in Aug.2014"</span>)</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">ax = sns.barplot(x=<span class="string">"day"</span>, y=<span class="string">"total_redeem_amt"</span>, data=day_sta, label=<span class="string">'Redeem'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"day"</span>, y=<span class="string">"total_redeem_amt"</span>, data=day_sta, label=<span class="string">'Redeem'</span>)</span><br><span class="line">ax.legend()</span><br><span class="line">plt.title(<span class="string">"The total Redeem in Aug.2014"</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_65_0.png" src="/img/loading.gif" class="lazyload"></p>
<ul>
<li>每周开始倾向购买，每周中期倾向于赎回</li>
<li>周末不倾向交易</li>
<li>赎回波动性比购买大</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance_last_9[<span class="string">'day'</span>] = total_balance_last_9[<span class="string">'date'</span>].dt.day</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出13年九月份的分布图</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>,<span class="number">10</span>))</span><br><span class="line">day_sta = total_balance_last_9[[<span class="string">'total_purchase_amt'</span>, <span class="string">'total_redeem_amt'</span>, <span class="string">'day'</span>]].groupby(<span class="string">'day'</span>, as_index=<span class="literal">False</span>).mean()</span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">"The total Purchase in Sep.2013"</span>)</span><br><span class="line">ax = sns.barplot(x=<span class="string">"day"</span>, y=<span class="string">"total_purchase_amt"</span>, data=day_sta, label=<span class="string">'Purchase'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"day"</span>, y=<span class="string">"total_purchase_amt"</span>, data=day_sta, label=<span class="string">'Purchase'</span>)</span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">"The total Redeem in Sep.2013"</span>)</span><br><span class="line">bx = sns.barplot(x=<span class="string">"day"</span>, y=<span class="string">"total_redeem_amt"</span>, data=day_sta, label=<span class="string">'Redeem'</span>)</span><br><span class="line">bx = sns.lineplot(x=<span class="string">"day"</span>, y=<span class="string">"total_redeem_amt"</span>, data=day_sta, label=<span class="string">'Redeem'</span>)</span><br><span class="line">bx.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_69_0.png" src="/img/loading.gif" class="lazyload"></p>
<ul>
<li>峰值：16号——购买峰值（中秋节前3天），周一</li>
<li>峰值：11号和25号——赎回峰值（周三），28号——赎回峰值（国庆节前）</li>
<li>重要日期：19-21号（中秋节）；28-30号（国庆节）</li>
<li>19、20、21 交易最低 中秋节</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance_1[<span class="string">'week'</span>] = total_balance_1[<span class="string">'date'</span>].dt.week</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance_1.head(<span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>total_purchase_amt</th>
      <th>total_redeem_amt</th>
      <th>weekday</th>
      <th>week</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>274</th>
      <td>2014-04-01</td>
      <td>453320585</td>
      <td>277429358</td>
      <td>1</td>
      <td>14</td>
    </tr>
    <tr>
      <th>275</th>
      <td>2014-04-02</td>
      <td>355347118</td>
      <td>272612066</td>
      <td>2</td>
      <td>14</td>
    </tr>
    <tr>
      <th>276</th>
      <td>2014-04-03</td>
      <td>363877120</td>
      <td>266605457</td>
      <td>3</td>
      <td>14</td>
    </tr>
  </tbody>
</table>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance_1.head(<span class="number">-1</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>total_purchase_amt</th>
      <th>total_redeem_amt</th>
      <th>weekday</th>
      <th>week</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>274</th>
      <td>2014-04-01</td>
      <td>453320585</td>
      <td>277429358</td>
      <td>1</td>
      <td>14</td>
    </tr>
    <tr>
      <th>275</th>
      <td>2014-04-02</td>
      <td>355347118</td>
      <td>272612066</td>
      <td>2</td>
      <td>14</td>
    </tr>
    <tr>
      <th>276</th>
      <td>2014-04-03</td>
      <td>363877120</td>
      <td>266605457</td>
      <td>3</td>
      <td>14</td>
    </tr>
    <tr>
      <th>277</th>
      <td>2014-04-04</td>
      <td>251895894</td>
      <td>200192637</td>
      <td>4</td>
      <td>14</td>
    </tr>
    <tr>
      <th>278</th>
      <td>2014-04-05</td>
      <td>202336542</td>
      <td>163199682</td>
      <td>5</td>
      <td>14</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>421</th>
      <td>2014-08-26</td>
      <td>306945089</td>
      <td>285478563</td>
      <td>1</td>
      <td>35</td>
    </tr>
    <tr>
      <th>422</th>
      <td>2014-08-27</td>
      <td>302194801</td>
      <td>468164147</td>
      <td>2</td>
      <td>35</td>
    </tr>
    <tr>
      <th>423</th>
      <td>2014-08-28</td>
      <td>245082751</td>
      <td>297893861</td>
      <td>3</td>
      <td>35</td>
    </tr>
    <tr>
      <th>424</th>
      <td>2014-08-29</td>
      <td>267554713</td>
      <td>273756380</td>
      <td>4</td>
      <td>35</td>
    </tr>
    <tr>
      <th>425</th>
      <td>2014-08-30</td>
      <td>199708772</td>
      <td>196374134</td>
      <td>5</td>
      <td>35</td>
    </tr>
  </tbody>
</table>
<p>152 rows × 5 columns</p>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">test = np.zeros((max(total_balance_1[<span class="string">'week'</span>]) - min(total_balance_1[<span class="string">'week'</span>]) + <span class="number">1</span>, <span class="number">7</span>))</span><br><span class="line">test</span><br></pre></td></tr></tbody></table></figure></div>


<pre><code>array([[0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.]])</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出历史所有天的热力图</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一共n周*7天</span></span><br><span class="line">test = np.zeros((max(total_balance_1[<span class="string">'week'</span>]) - min(total_balance_1[<span class="string">'week'</span>]) + <span class="number">1</span>, <span class="number">7</span>))</span><br><span class="line"><span class="comment"># 赋值</span></span><br><span class="line">test[total_balance_1[<span class="string">'week'</span>] - min(total_balance_1[<span class="string">'week'</span>]), total_balance_1[<span class="string">'weekday'</span>]] = total_balance_1[<span class="string">'total_purchase_amt'</span>]</span><br><span class="line"></span><br><span class="line">f, ax = plt.subplots(figsize = (<span class="number">10</span>, <span class="number">4</span>))</span><br><span class="line">sns.heatmap(test,linewidths = <span class="number">0.1</span>, ax=ax)</span><br><span class="line">ax.set_title(<span class="string">"Purchase"</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">'weekday'</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">'week'</span>)</span><br><span class="line"></span><br><span class="line">test = np.zeros((max(total_balance_1[<span class="string">'week'</span>]) - min(total_balance_1[<span class="string">'week'</span>]) + <span class="number">1</span>, <span class="number">7</span>))</span><br><span class="line">test[total_balance_1[<span class="string">'week'</span>] - min(total_balance_1[<span class="string">'week'</span>]), total_balance_1[<span class="string">'weekday'</span>]] = total_balance_1[<span class="string">'total_redeem_amt'</span>]</span><br><span class="line"></span><br><span class="line">f, ax = plt.subplots(figsize = (<span class="number">10</span>, <span class="number">4</span>))</span><br><span class="line">sns.heatmap(test,linewidths = <span class="number">0.1</span>, ax=ax)</span><br><span class="line">ax.set_title(<span class="string">"Redeem"</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">'weekday'</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">'week'</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_76_0.png" src="/img/loading.gif" class="lazyload"></p>
<p><img alt data-src="/images/output_76_1.png" src="/img/loading.gif" class="lazyload"></p>
<p>可以看到异常值</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 对于热力图中异常点的数据分析.1</span></span><br><span class="line">total_balance_1[(total_balance_1[<span class="string">'week'</span>] == <span class="number">4</span> + min(total_balance_1[<span class="string">'week'</span>])) & (total_balance_1[<span class="string">'weekday'</span>] == <span class="number">6</span>)]</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>total_purchase_amt</th>
      <th>total_redeem_amt</th>
      <th>weekday</th>
      <th>week</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>307</th>
      <td>2014-05-04</td>
      <td>303087562</td>
      <td>413222034</td>
      <td>6</td>
      <td>18</td>
    </tr>
  </tbody>
</table>

</div>

<p>五一之后的第一个工作日 amazing</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 对于热力图中异常点的数据分析.2</span></span><br><span class="line">total_balance_1[(total_balance_1[<span class="string">'week'</span>] == <span class="number">12</span> + min(total_balance_1[<span class="string">'week'</span>])) & (total_balance_1[<span class="string">'weekday'</span>] == <span class="number">2</span>)]</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>total_purchase_amt</th>
      <th>total_redeem_amt</th>
      <th>weekday</th>
      <th>week</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>359</th>
      <td>2014-06-25</td>
      <td>264663201</td>
      <td>547295931</td>
      <td>2</td>
      <td>26</td>
    </tr>
  </tbody>
</table>

</div>

<p>申购很少 售出很多 和银行政策有关</p>
<h3 id="对于节假期的分析"><a href="#对于节假期的分析" class="headerlink" title="对于节假期的分析"></a>对于节假期的分析</h3><p>清明节、劳动节、端午节<br>6.18天猫活动</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">qingming = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">5</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">8</span>))]</span><br><span class="line">labour = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">5</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,<span class="number">5</span>,<span class="number">4</span>))]</span><br><span class="line">duanwu = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">5</span>,<span class="number">31</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,<span class="number">6</span>,<span class="number">3</span>))]</span><br><span class="line">data618 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">6</span>,<span class="number">10</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,<span class="number">6</span>,<span class="number">20</span>))]</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出节假日与平时的均值</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">index_list = [<span class="string">'QM'</span>,<span class="string">'Labour'</span>,<span class="string">'DW'</span>,<span class="string">'618'</span>,<span class="string">'Mean'</span>]</span><br><span class="line">label_list = [np.mean(qingming[<span class="string">'total_purchase_amt'</span>]), np.mean(labour[<span class="string">'total_purchase_amt'</span>]),np.mean(duanwu[<span class="string">'total_purchase_amt'</span>]),np.mean(data618[<span class="string">'total_purchase_amt'</span>]),np.mean(total_balance_1[<span class="string">'total_purchase_amt'</span>])]</span><br><span class="line">plt.bar(index_list, label_list, label=<span class="string">"Purchase"</span>)</span><br><span class="line"></span><br><span class="line">index_list = [<span class="string">'QM.'</span>,<span class="string">'Labour.'</span>,<span class="string">'DW.'</span>,<span class="string">'618.'</span>,<span class="string">'Mean.'</span>]</span><br><span class="line">label_list = [np.mean(qingming[<span class="string">'total_redeem_amt'</span>]), np.mean(labour[<span class="string">'total_redeem_amt'</span>]),np.mean(duanwu[<span class="string">'total_redeem_amt'</span>]),np.mean(data618[<span class="string">'total_redeem_amt'</span>]),np.mean(total_balance_1[<span class="string">'total_redeem_amt'</span>])]</span><br><span class="line">plt.bar(index_list, label_list, label=<span class="string">"Redeem"</span>)</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">"The average of different holiday"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_85_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出节假日购买量与其所处周几的对比</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">size = <span class="number">4</span></span><br><span class="line">x = np.arange(size)</span><br><span class="line"></span><br><span class="line">total_width, n = <span class="number">0.8</span>, <span class="number">2</span>   </span><br><span class="line">width = total_width / n</span><br><span class="line">x = x - (total_width - width) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">176250006</span>, <span class="number">167825284</span>, <span class="number">162844282</span>,<span class="number">321591063</span>]</span><br><span class="line">b = [<span class="number">225337516</span>, <span class="number">241859315</span>, <span class="number">225337516</span>,<span class="number">307635449</span>]</span><br><span class="line"></span><br><span class="line">plt.bar(x, a,  width=width, label=<span class="string">'Holiday_Purchase'</span>)</span><br><span class="line">plt.bar(x + width, b, width=width, label=<span class="string">'Normal_Purchase'</span>)</span><br><span class="line">plt.xticks(x + width / <span class="number">2</span>, (<span class="string">'QingMing'</span>, <span class="string">'Labour'</span>, <span class="string">'DuanWu'</span>, <span class="string">'618'</span>))</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_86_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出节假日赎回量与其所处周几的对比</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">size = <span class="number">4</span></span><br><span class="line">x = np.arange(size)</span><br><span class="line"></span><br><span class="line">total_width, n = <span class="number">0.8</span>, <span class="number">2</span>     </span><br><span class="line">width = total_width / n</span><br><span class="line">x = x - (total_width - width) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">159914308</span>, <span class="number">154717620</span>, <span class="number">154366940</span>,<span class="number">291016763</span>]</span><br><span class="line">b = [<span class="number">235439685</span>, <span class="number">240364238</span>, <span class="number">235439685</span>,<span class="number">313310347</span>]</span><br><span class="line"></span><br><span class="line">plt.bar(x, a,  width=width, label=<span class="string">'Holiday_Redeem'</span>)</span><br><span class="line">plt.bar(x + width, b, width=width, label=<span class="string">'Normal_Redeem'</span>)</span><br><span class="line">plt.xticks(x + width / <span class="number">2</span>, (<span class="string">'QingMing'</span>, <span class="string">'Labour'</span>, <span class="string">'DuanWu'</span>, <span class="string">'618'</span>))</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_87_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出清明节与周边日期的时序图</span></span><br><span class="line"></span><br><span class="line">qingming_around = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">13</span>))]</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=qingming_around, label=<span class="string">'Purchase'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=qingming_around, label=<span class="string">'Redeem'</span>, ax=ax)</span><br><span class="line">ax = sns.scatterplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=qingming, ax=ax)</span><br><span class="line">ax = sns.scatterplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=qingming, ax=ax)</span><br><span class="line">plt.title(<span class="string">"The data around Qingming Holiday"</span>)</span><br><span class="line">ax.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_88_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出劳动节与周边日期的时序图</span></span><br><span class="line"></span><br><span class="line">ax = plt.subplots(figsize = (<span class="number">10</span>, <span class="number">4</span>))</span><br><span class="line">labour_around = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">25</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,<span class="number">5</span>,<span class="number">10</span>))]</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=labour_around, label=<span class="string">'Purchase'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=labour_around, label=<span class="string">'Redeem'</span>, ax=ax)</span><br><span class="line">ax = sns.scatterplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=labour, ax=ax)</span><br><span class="line">ax = sns.scatterplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=labour, ax=ax)</span><br><span class="line">plt.title(<span class="string">"The data around Labour holiday"</span>)</span><br><span class="line">ax.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_89_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># # 画出端午节与周边日期的时序图</span></span><br><span class="line"></span><br><span class="line">ax = plt.subplots(figsize = (<span class="number">12</span>, <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">duanwu_around = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">5</span>,<span class="number">25</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,<span class="number">6</span>,<span class="number">7</span>))]</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=duanwu_around, label=<span class="string">'Purchase'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=duanwu_around, label=<span class="string">'Redeem'</span>, ax=ax)</span><br><span class="line">ax = sns.scatterplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=duanwu, ax=ax)</span><br><span class="line">ax = sns.scatterplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=duanwu, ax=ax)</span><br><span class="line">plt.title(<span class="string">"The data around Duanwu Holiday"</span>)</span><br><span class="line">ax.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_90_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出中秋与周边日期的时序图</span></span><br><span class="line">ax = plt.subplots(figsize = (<span class="number">12</span>, <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">zhongqiu = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,<span class="number">9</span>,<span class="number">19</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,<span class="number">9</span>,<span class="number">22</span>))]</span><br><span class="line">zhongqiu_around = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,<span class="number">9</span>,<span class="number">14</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,<span class="number">9</span>,<span class="number">28</span>))]</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=zhongqiu_around, label=<span class="string">'Purchase'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=zhongqiu_around, label=<span class="string">'Redeem'</span>, ax=ax)</span><br><span class="line">ax = sns.scatterplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=zhongqiu, ax=ax)</span><br><span class="line">ax = sns.scatterplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=zhongqiu, ax=ax)</span><br><span class="line">plt.title(<span class="string">"The data around MiddleAutumn Holiday(in 2013)"</span>)</span><br><span class="line">ax.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_91_0.png" src="/img/loading.gif" class="lazyload"></p>
<h3 id="分析大额交易-异常值"><a href="#分析大额交易-异常值" class="headerlink" title="分析大额交易 异常值"></a>分析大额交易 异常值</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出用户交易纪录的箱型图</span></span><br><span class="line">sns.boxplot(data_balance[<span class="string">'total_purchase_amt'</span>])</span><br><span class="line">plt.title(<span class="string">"The abnormal value of total purchase"</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_93_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 对于购买2e8的用户的交易行为分析</span></span><br><span class="line"><span class="comment"># 按照售出排序</span></span><br><span class="line">data_balance[data_balance[<span class="string">'user_id'</span>] == <span class="number">14592</span>].sort_values(by = <span class="string">'total_purchase_amt'</span>,axis = <span class="number">0</span>,ascending = <span class="literal">False</span>).head()</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>report_date</th>
      <th>tBalance</th>
      <th>yBalance</th>
      <th>total_purchase_amt</th>
      <th>direct_purchase_amt</th>
      <th>purchase_bal_amt</th>
      <th>purchase_bank_amt</th>
      <th>total_redeem_amt</th>
      <th>consume_amt</th>
      <th>...</th>
      <th>category1</th>
      <th>category2</th>
      <th>category3</th>
      <th>category4</th>
      <th>date</th>
      <th>day</th>
      <th>month</th>
      <th>year</th>
      <th>week</th>
      <th>weekday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1453311</th>
      <td>14592</td>
      <td>20131104</td>
      <td>99457728</td>
      <td>0</td>
      <td>201768328</td>
      <td>201768328</td>
      <td>201275171</td>
      <td>493157</td>
      <td>102310600</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2013-11-04</td>
      <td>4</td>
      <td>11</td>
      <td>2013</td>
      <td>45</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1453379</th>
      <td>14592</td>
      <td>20140520</td>
      <td>98653624</td>
      <td>375218</td>
      <td>98278406</td>
      <td>98278357</td>
      <td>98278357</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2014-05-20</td>
      <td>20</td>
      <td>5</td>
      <td>2014</td>
      <td>21</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1453313</th>
      <td>14592</td>
      <td>20131105</td>
      <td>97458675</td>
      <td>99457728</td>
      <td>4899446</td>
      <td>4899446</td>
      <td>4899446</td>
      <td>0</td>
      <td>6898499</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2013-11-05</td>
      <td>5</td>
      <td>11</td>
      <td>2013</td>
      <td>45</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1453388</th>
      <td>14592</td>
      <td>20140616</td>
      <td>0</td>
      <td>98964529</td>
      <td>1966014</td>
      <td>1953569</td>
      <td>0</td>
      <td>1953569</td>
      <td>100930543</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2014-06-16</td>
      <td>16</td>
      <td>6</td>
      <td>2014</td>
      <td>25</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1453355</th>
      <td>14592</td>
      <td>20140617</td>
      <td>0</td>
      <td>0</td>
      <td>339679</td>
      <td>339679</td>
      <td>0</td>
      <td>339679</td>
      <td>339679</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2014-06-17</td>
      <td>17</td>
      <td>6</td>
      <td>2014</td>
      <td>25</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 24 columns</p>

</div>

<p>11月4号约2亿购买量</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance[<span class="string">'day'</span>]= total_balance[<span class="string">'date'</span>].dt.day</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出单笔交易为2e8的那天的总交易量及附近几天的交易量</span></span><br><span class="line"></span><br><span class="line">ax = plt.subplots(figsize = (<span class="number">8</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line">e2 = total_balance[(total_balance[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2013</span>,<span class="number">11</span>,<span class="number">1</span>)) & (total_balance[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2013</span>,<span class="number">11</span>,<span class="number">10</span>))]</span><br><span class="line">ax = sns.barplot(x=<span class="string">"day"</span>, y=<span class="string">"total_purchase_amt"</span>, data=e2, label=<span class="string">'2E'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"day"</span>, y=<span class="string">"total_purchase_amt"</span>, data=e2, label=<span class="string">'2E'</span>)</span><br><span class="line">plt.title(<span class="string">"The influence of the big deal with 200 million purchasing(Red Bar)"</span>)</span><br><span class="line">ax.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_97_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出每日单笔最大交易的时序图</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">20</span>, <span class="number">6</span>))</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=data_balance[[<span class="string">'total_purchase_amt'</span>, <span class="string">'date'</span>]].groupby(<span class="string">'date'</span>, as_index=<span class="literal">False</span>).max(), label=<span class="string">'MAX_PURCHASE'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=data_balance[[<span class="string">'total_redeem_amt'</span>, <span class="string">'date'</span>]].groupby(<span class="string">'date'</span>, as_index=<span class="literal">False</span>).max(), label=<span class="string">'MAX_REDEEM'</span>)</span><br><span class="line">plt.title(<span class="string">"The Biggest deal happend in each day"</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_98_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出每日单笔最大交易+总交易额的时序图</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">20</span>, <span class="number">6</span>))</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=data_balance[[<span class="string">'total_purchase_amt'</span>, <span class="string">'date'</span>]].groupby(<span class="string">'date'</span>, as_index=<span class="literal">False</span>).max(), label=<span class="string">'MAX_PURCHASE'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=data_balance[[<span class="string">'total_redeem_amt'</span>, <span class="string">'date'</span>]].groupby(<span class="string">'date'</span>, as_index=<span class="literal">False</span>).max(), label=<span class="string">'MAX_REDEEM'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_purchase_amt"</span>, data=data_balance[[<span class="string">'total_purchase_amt'</span>, <span class="string">'date'</span>]].groupby(<span class="string">'date'</span>, as_index=<span class="literal">False</span>).sum(), label=<span class="string">'TOTAL_PURCHASE'</span>)</span><br><span class="line">ax = sns.lineplot(x=<span class="string">"date"</span>, y=<span class="string">"total_redeem_amt"</span>, data=data_balance[[<span class="string">'total_redeem_amt'</span>, <span class="string">'date'</span>]].groupby(<span class="string">'date'</span>, as_index=<span class="literal">False</span>).sum(), label=<span class="string">'TOTAL_REDEEM'</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_99_0.png" src="/img/loading.gif" class="lazyload"></p>
<p>在14年占比较低<br>大额交易次数也逐渐稳定</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出每个月大额交易的频次直方图</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">6</span>))</span><br><span class="line">big_frequancy = data_balance[(data_balance[<span class="string">'total_purchase_amt'</span>] > <span class="number">10000000</span>) | (data_balance[<span class="string">'total_redeem_amt'</span>] > <span class="number">10000000</span>)][[<span class="string">'month'</span>,<span class="string">'year'</span>,<span class="string">'user_id'</span>]].groupby([<span class="string">'year'</span>,<span class="string">'month'</span>], as_index=<span class="literal">False</span>).count()</span><br><span class="line"></span><br><span class="line">big_frequancy[<span class="string">'i'</span>] = big_frequancy[<span class="string">'year'</span>]  + big_frequancy[<span class="string">'month'</span>] / <span class="number">100</span></span><br><span class="line"></span><br><span class="line">ax = sns.barplot(x=<span class="string">"i"</span>, y=<span class="string">"user_id"</span>, data=big_frequancy)</span><br><span class="line">plt.title(<span class="string">"The frequency of super big deal(larger than 100million) in each month"</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_101_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 获取大额交易的数据集</span></span><br><span class="line"><span class="comment"># 二分类 令其值为1</span></span><br><span class="line">data_balance[<span class="string">'big_purchase'</span>] = <span class="number">0</span></span><br><span class="line">data_balance.loc[data_balance[<span class="string">'total_purchase_amt'</span>] > <span class="number">1000000</span>, <span class="string">'big_purchase'</span>] = <span class="number">1</span></span><br><span class="line">data_balance[<span class="string">'big_redeem'</span>] = <span class="number">0</span></span><br><span class="line">data_balance.loc[data_balance[<span class="string">'total_redeem_amt'</span>] > <span class="number">1000000</span>, <span class="string">'big_redeem'</span>] = <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 对大额交易按每天做聚合操作</span></span><br><span class="line"></span><br><span class="line">big_purchase = data_balance[data_balance[<span class="string">'big_purchase'</span>] == <span class="number">1</span>].groupby([<span class="string">'date'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_purchase_amt'</span>].sum()</span><br><span class="line">small_purchase = data_balance[data_balance[<span class="string">'big_purchase'</span>] == <span class="number">0</span>].groupby([<span class="string">'date'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_purchase_amt'</span>].sum()</span><br><span class="line">big_redeem = data_balance[data_balance[<span class="string">'big_redeem'</span>] == <span class="number">1</span>].groupby([<span class="string">'date'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_redeem_amt'</span>].sum()</span><br><span class="line">small_redeem = data_balance[data_balance[<span class="string">'big_redeem'</span>] == <span class="number">0</span>].groupby([<span class="string">'date'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_redeem_amt'</span>].sum()</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出大额交易与小额交易的时序分布图</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">20</span>,<span class="number">6</span>))</span><br><span class="line">plt.plot(big_purchase[<span class="string">'date'</span>], big_purchase[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'big_purchase'</span>)</span><br><span class="line">plt.plot(big_redeem[<span class="string">'date'</span>], big_redeem[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'big_redeem'</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(small_purchase[<span class="string">'date'</span>], small_purchase[<span class="string">'total_purchase_amt'</span>],label=<span class="string">'small_purchase'</span>)</span><br><span class="line">plt.plot(small_redeem[<span class="string">'date'</span>], small_redeem[<span class="string">'total_redeem_amt'</span>],label=<span class="string">'small_redeem'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of big deal of Purchase and Redeem from July.13 to Sep.14"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_104_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">big_purchase.head(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>total_purchase_amt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-07-01</td>
      <td>19546710</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-07-02</td>
      <td>18329849</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-07-03</td>
      <td>14787689</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-07-04</td>
      <td>4785316</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-07-05</td>
      <td>1955408</td>
    </tr>
  </tbody>
</table>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出大额交易与小额交易的分布估计图</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>, <span class="number">9</span>):</span><br><span class="line">    sns.kdeplot(big_purchase[(big_purchase[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,i,<span class="number">1</span>)) & (big_purchase[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,i+<span class="number">1</span>,<span class="number">1</span>))][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'14Y,'</span>+str(i)+<span class="string">'M'</span>)</span><br><span class="line">plt.title(<span class="string">'BIG PURCHASE'</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>, <span class="number">9</span>):</span><br><span class="line">    sns.kdeplot(small_purchase[(small_purchase[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,i,<span class="number">1</span>)) & (small_purchase[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,i+<span class="number">1</span>,<span class="number">1</span>))][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'14Y,'</span>+str(i)+<span class="string">'M'</span>)</span><br><span class="line">plt.title(<span class="string">'SMALL PURCHASE'</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>, <span class="number">9</span>):</span><br><span class="line">    sns.kdeplot(big_redeem[(big_redeem[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,i,<span class="number">1</span>)) & (big_redeem[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,i+<span class="number">1</span>,<span class="number">1</span>))][<span class="string">'total_redeem_amt'</span>],label=<span class="string">'14Y,'</span>+str(i)+<span class="string">'M'</span>)</span><br><span class="line">plt.title(<span class="string">'BIG REDEEM'</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>, <span class="number">9</span>):</span><br><span class="line">    sns.kdeplot(small_redeem[(small_redeem[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,i,<span class="number">1</span>)) & (small_redeem[<span class="string">'date'</span>] < datetime.datetime(<span class="number">2014</span>,i+<span class="number">1</span>,<span class="number">1</span>))][<span class="string">'total_redeem_amt'</span>],label=<span class="string">'14Y,'</span>+str(i)+<span class="string">'M'</span>)</span><br><span class="line">plt.title(<span class="string">'SMALL REDEEM'</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_106_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 添加时间戳</span></span><br><span class="line">big_purchase[<span class="string">'weekday'</span>] = big_purchase[<span class="string">'date'</span>].dt.weekday</span><br><span class="line">small_purchase[<span class="string">'weekday'</span>] = small_purchase[<span class="string">'date'</span>].dt.weekday</span><br><span class="line">big_redeem[<span class="string">'weekday'</span>] = big_redeem[<span class="string">'date'</span>].dt.weekday</span><br><span class="line">small_redeem[<span class="string">'weekday'</span>] = small_redeem[<span class="string">'date'</span>].dt.weekday</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 分析大额小额的周几分布</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>, <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">ax = sns.boxplot(x=<span class="string">"weekday"</span>, y=<span class="string">"total_purchase_amt"</span>, data=big_purchase[big_purchase[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">1</span>)])</span><br><span class="line">plt.title(<span class="string">'BIG PURCHASE'</span>)</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">ax = sns.boxplot(x=<span class="string">"weekday"</span>, y=<span class="string">"total_redeem_amt"</span>, data=big_redeem[big_redeem[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">1</span>)])</span><br><span class="line">plt.title(<span class="string">'BIG REDEEM'</span>)</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">ax = sns.boxplot(x=<span class="string">"weekday"</span>, y=<span class="string">"total_purchase_amt"</span>, data=small_purchase[small_purchase[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">1</span>)])</span><br><span class="line">plt.title(<span class="string">'SMALL PURCHASE'</span>)</span><br><span class="line"></span><br><span class="line">ax = plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line">ax = sns.boxplot(x=<span class="string">"weekday"</span>, y=<span class="string">"total_redeem_amt"</span>, data=small_redeem[small_redeem[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">1</span>)])</span><br><span class="line">plt.title(<span class="string">'SMALL REDEEM'</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_108_0.png" src="/img/loading.gif" class="lazyload"></p>
<ul>
<li>大额交易：大于100万</li>
<li>小额交易的购买大于赎回</li>
<li>14年5月下旬后，大额交易的赎回大于购买（资本套现）</li>
<li>大额交易更不愿在周五发生</li>
</ul>
<p>累了</p>
<h3 id="分析用户交易纪录表中其他变量"><a href="#分析用户交易纪录表中其他变量" class="headerlink" title="分析用户交易纪录表中其他变量"></a>分析用户交易纪录表中其他变量</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 截断数据集</span></span><br><span class="line">data_balance_1 = data_balance[data_balance[<span class="string">'date'</span>] > datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">1</span>)]</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出用户交易纪录表中其他变量与标签的相关性图</span></span><br><span class="line"></span><br><span class="line">feature = [<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>, <span class="string">'report_date'</span>, <span class="string">'tBalance'</span>, <span class="string">'yBalance'</span>, </span><br><span class="line">       <span class="string">'direct_purchase_amt'</span>, <span class="string">'purchase_bal_amt'</span>, <span class="string">'purchase_bank_amt'</span>,</span><br><span class="line">        <span class="string">'consume_amt'</span>, <span class="string">'transfer_amt'</span>, <span class="string">'tftobal_amt'</span>,</span><br><span class="line">       <span class="string">'tftocard_amt'</span>, <span class="string">'share_amt'</span>]</span><br><span class="line"></span><br><span class="line">sns.heatmap(data_balance_1[feature].corr(), linewidths = <span class="number">0.05</span>)   </span><br><span class="line">plt.title(<span class="string">"The coleration between each feature in User_Balance_Table"</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_113_0.png" src="/img/loading.gif" class="lazyload"></p>
<h3 id="对于银行及支付宝利率的分析"><a href="#对于银行及支付宝利率的分析" class="headerlink" title="对于银行及支付宝利率的分析"></a>对于银行及支付宝利率的分析</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 读取银行利率并添加时间戳</span></span><br><span class="line">bank = pd.read_csv(dataset_path + <span class="string">"mfd_bank_shibor.csv"</span>)</span><br><span class="line">bank = bank.rename(columns = {<span class="string">'mfd_date'</span>: <span class="string">'date'</span>})</span><br><span class="line">bank_features = [x <span class="keyword">for</span> x <span class="keyword">in</span> bank.columns <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'date'</span>]]</span><br><span class="line">bank[<span class="string">'date'</span>] = pd.to_datetime(bank[<span class="string">'date'</span>], format= <span class="string">"%Y%m%d"</span>)</span><br><span class="line">bank[<span class="string">'day'</span>] = bank[<span class="string">'date'</span>].dt.day</span><br><span class="line">bank[<span class="string">'month'</span>] = bank[<span class="string">'date'</span>].dt.month</span><br><span class="line">bank[<span class="string">'year'</span>] = bank[<span class="string">'date'</span>].dt.year</span><br><span class="line">bank[<span class="string">'week'</span>] = bank[<span class="string">'date'</span>].dt.week</span><br><span class="line">bank[<span class="string">'weekday'</span>] = bank[<span class="string">'date'</span>].dt.weekday</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">bank.head(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>Interest_O_N</th>
      <th>Interest_1_W</th>
      <th>Interest_2_W</th>
      <th>Interest_1_M</th>
      <th>Interest_3_M</th>
      <th>Interest_6_M</th>
      <th>Interest_9_M</th>
      <th>Interest_1_Y</th>
      <th>day</th>
      <th>month</th>
      <th>year</th>
      <th>week</th>
      <th>weekday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-07-01</td>
      <td>4.456</td>
      <td>5.423</td>
      <td>6.040</td>
      <td>6.8800</td>
      <td>5.295</td>
      <td>4.2390</td>
      <td>4.2820</td>
      <td>4.4125</td>
      <td>1</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-07-02</td>
      <td>3.786</td>
      <td>4.750</td>
      <td>5.074</td>
      <td>5.8000</td>
      <td>5.211</td>
      <td>4.2344</td>
      <td>4.2808</td>
      <td>4.4070</td>
      <td>2</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-07-03</td>
      <td>3.400</td>
      <td>4.242</td>
      <td>4.658</td>
      <td>5.2000</td>
      <td>5.148</td>
      <td>4.2300</td>
      <td>4.2796</td>
      <td>4.4022</td>
      <td>3</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-07-04</td>
      <td>3.348</td>
      <td>3.938</td>
      <td>4.464</td>
      <td>5.1020</td>
      <td>5.029</td>
      <td>4.2287</td>
      <td>4.2776</td>
      <td>4.4000</td>
      <td>4</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-07-05</td>
      <td>3.380</td>
      <td>3.816</td>
      <td>4.295</td>
      <td>4.7885</td>
      <td>4.939</td>
      <td>4.2273</td>
      <td>4.2749</td>
      <td>4.4000</td>
      <td>5</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>4</td>
    </tr>
  </tbody>
</table>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 读取支付宝利率并添加时间戳</span></span><br><span class="line">share = pd.read_csv(dataset_path + <span class="string">'mfd_day_share_interest.csv'</span>)</span><br><span class="line">share = share.rename(columns = {<span class="string">'mfd_date'</span>: <span class="string">'date'</span>})</span><br><span class="line">share_features = [x <span class="keyword">for</span> x <span class="keyword">in</span> share.columns <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'date'</span>]]</span><br><span class="line">share[<span class="string">'date'</span>] = pd.to_datetime(share[<span class="string">'date'</span>], format= <span class="string">"%Y%m%d"</span>)</span><br><span class="line">share[<span class="string">'day'</span>] = share[<span class="string">'date'</span>].dt.day</span><br><span class="line">share[<span class="string">'month'</span>] = share[<span class="string">'date'</span>].dt.month</span><br><span class="line">share[<span class="string">'year'</span>] = share[<span class="string">'date'</span>].dt.year</span><br><span class="line">share[<span class="string">'week'</span>] = share[<span class="string">'date'</span>].dt.week</span><br><span class="line">share[<span class="string">'weekday'</span>] = share[<span class="string">'date'</span>].dt.weekday</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">share.head(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>mfd_daily_yield</th>
      <th>mfd_7daily_yield</th>
      <th>day</th>
      <th>month</th>
      <th>year</th>
      <th>week</th>
      <th>weekday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-07-01</td>
      <td>1.5787</td>
      <td>6.307</td>
      <td>1</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-07-02</td>
      <td>1.5461</td>
      <td>6.174</td>
      <td>2</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-07-03</td>
      <td>1.4670</td>
      <td>6.034</td>
      <td>3</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-07-04</td>
      <td>1.4223</td>
      <td>5.903</td>
      <td>4</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-07-05</td>
      <td>1.3845</td>
      <td>5.739</td>
      <td>5</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>4</td>
    </tr>
  </tbody>
</table>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance.head(<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>total_purchase_amt</th>
      <th>total_redeem_amt</th>
      <th>weekday</th>
      <th>day</th>
      <th>week</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-07-01</td>
      <td>32488348</td>
      <td>5525022</td>
      <td>0</td>
      <td>1</td>
      <td>27</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-07-02</td>
      <td>29037390</td>
      <td>2554548</td>
      <td>1</td>
      <td>2</td>
      <td>27</td>
    </tr>
  </tbody>
</table>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出上一天支付宝利率与标签的相关性图</span></span><br><span class="line"><span class="comment"># 后一天利率 前一天交易额？</span></span><br><span class="line"></span><br><span class="line">bank[<span class="string">'last_date'</span>] = bank[<span class="string">'date'</span>] + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">"The coleration between each lastday bank rate and total purchase"</span>)</span><br><span class="line">temp = pd.merge(bank[[<span class="string">'last_date'</span>]+bank_features], total_balance, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_purchase_amt'</span>]+bank_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>)  </span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">plt.title(<span class="string">"The coleration between each lastday bank rate and total redeem"</span>)</span><br><span class="line">temp = pd.merge(bank[[<span class="string">'last_date'</span>]+bank_features], total_balance, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_redeem_amt'</span>]+bank_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>)  </span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_120_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">bank.head(<span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>Interest_O_N</th>
      <th>Interest_1_W</th>
      <th>Interest_2_W</th>
      <th>Interest_1_M</th>
      <th>Interest_3_M</th>
      <th>Interest_6_M</th>
      <th>Interest_9_M</th>
      <th>Interest_1_Y</th>
      <th>day</th>
      <th>month</th>
      <th>year</th>
      <th>week</th>
      <th>weekday</th>
      <th>last_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-07-01</td>
      <td>4.456</td>
      <td>5.423</td>
      <td>6.040</td>
      <td>6.88</td>
      <td>5.295</td>
      <td>4.2390</td>
      <td>4.2820</td>
      <td>4.4125</td>
      <td>1</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>0</td>
      <td>2013-07-02</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-07-02</td>
      <td>3.786</td>
      <td>4.750</td>
      <td>5.074</td>
      <td>5.80</td>
      <td>5.211</td>
      <td>4.2344</td>
      <td>4.2808</td>
      <td>4.4070</td>
      <td>2</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>1</td>
      <td>2013-07-03</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-07-03</td>
      <td>3.400</td>
      <td>4.242</td>
      <td>4.658</td>
      <td>5.20</td>
      <td>5.148</td>
      <td>4.2300</td>
      <td>4.2796</td>
      <td>4.4022</td>
      <td>3</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>2</td>
      <td>2013-07-04</td>
    </tr>
  </tbody>
</table>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance[<span class="string">'week'</span>] = total_balance[<span class="string">'date'</span>].dt.week</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出上一星期银行及支付宝利率与标签的相关性图</span></span><br><span class="line"></span><br><span class="line">bank[<span class="string">'last_week'</span>] = bank[<span class="string">'week'</span>] + <span class="number">1</span></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">"The coleration between each last week bank rate and total purchase"</span>)</span><br><span class="line">temp = pd.merge(bank[[<span class="string">'last_week'</span>,<span class="string">'weekday'</span>]+bank_features], total_balance, left_on=[<span class="string">'last_week'</span>,<span class="string">'weekday'</span>], right_on=[<span class="string">'week'</span>,<span class="string">'weekday'</span>])[[<span class="string">'total_purchase_amt'</span>]+bank_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>)  </span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">plt.title(<span class="string">"The coleration between each last week bank rate and total redeem"</span>)</span><br><span class="line">temp = pd.merge(bank[[<span class="string">'last_week'</span>,<span class="string">'weekday'</span>]+bank_features], total_balance, left_on=[<span class="string">'last_week'</span>,<span class="string">'weekday'</span>], right_on=[<span class="string">'week'</span>,<span class="string">'weekday'</span>])[[<span class="string">'total_redeem_amt'</span>]+bank_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>) </span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_123_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 分别画出上一星期银行及支付宝利率与大额小额数据的相关性图</span></span><br><span class="line"></span><br><span class="line">bank[<span class="string">'last_date'</span>] = bank[<span class="string">'date'</span>] + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>))</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">"The coleration of Small Rate purchase"</span>)</span><br><span class="line">temp = pd.merge(bank[[<span class="string">'last_date'</span>]+bank_features], small_purchase, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_purchase_amt'</span>]+bank_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>)  </span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">plt.title(<span class="string">"The coleration of Small Rate redeem"</span>)</span><br><span class="line">temp = pd.merge(bank[[<span class="string">'last_date'</span>]+bank_features], small_redeem, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_redeem_amt'</span>]+bank_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>)  </span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_124_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">bank[<span class="string">'last_date'</span>] = bank[<span class="string">'date'</span>] + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>))</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">"The coleration of Big Rate purchase"</span>)</span><br><span class="line">temp = pd.merge(bank[[<span class="string">'last_date'</span>]+bank_features], big_purchase, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_purchase_amt'</span>]+bank_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>)  </span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">plt.title(<span class="string">"The coleration of Big Rate redeem"</span>)</span><br><span class="line">temp = pd.merge(bank[[<span class="string">'last_date'</span>]+bank_features], big_redeem, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_redeem_amt'</span>]+bank_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>)  </span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_125_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">bank_features</span><br></pre></td></tr></tbody></table></figure></div>


<pre><code>['Interest_O_N',
 'Interest_1_W',
 'Interest_2_W',
 'Interest_1_M',
 'Interest_3_M',
 'Interest_6_M',
 'Interest_9_M',
 'Interest_1_Y']</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">bank</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>Interest_O_N</th>
      <th>Interest_1_W</th>
      <th>Interest_2_W</th>
      <th>Interest_1_M</th>
      <th>Interest_3_M</th>
      <th>Interest_6_M</th>
      <th>Interest_9_M</th>
      <th>Interest_1_Y</th>
      <th>day</th>
      <th>month</th>
      <th>year</th>
      <th>week</th>
      <th>weekday</th>
      <th>last_date</th>
      <th>last_week</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-07-01</td>
      <td>4.456</td>
      <td>5.423</td>
      <td>6.0400</td>
      <td>6.8800</td>
      <td>5.2950</td>
      <td>4.2390</td>
      <td>4.2820</td>
      <td>4.4125</td>
      <td>1</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>0</td>
      <td>2013-07-02</td>
      <td>28</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-07-02</td>
      <td>3.786</td>
      <td>4.750</td>
      <td>5.0740</td>
      <td>5.8000</td>
      <td>5.2110</td>
      <td>4.2344</td>
      <td>4.2808</td>
      <td>4.4070</td>
      <td>2</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>1</td>
      <td>2013-07-03</td>
      <td>28</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-07-03</td>
      <td>3.400</td>
      <td>4.242</td>
      <td>4.6580</td>
      <td>5.2000</td>
      <td>5.1480</td>
      <td>4.2300</td>
      <td>4.2796</td>
      <td>4.4022</td>
      <td>3</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>2</td>
      <td>2013-07-04</td>
      <td>28</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-07-04</td>
      <td>3.348</td>
      <td>3.938</td>
      <td>4.4640</td>
      <td>5.1020</td>
      <td>5.0290</td>
      <td>4.2287</td>
      <td>4.2776</td>
      <td>4.4000</td>
      <td>4</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>3</td>
      <td>2013-07-05</td>
      <td>28</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-07-05</td>
      <td>3.380</td>
      <td>3.816</td>
      <td>4.2950</td>
      <td>4.7885</td>
      <td>4.9390</td>
      <td>4.2273</td>
      <td>4.2749</td>
      <td>4.4000</td>
      <td>5</td>
      <td>7</td>
      <td>2013</td>
      <td>27</td>
      <td>4</td>
      <td>2013-07-06</td>
      <td>28</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>289</th>
      <td>2014-08-25</td>
      <td>2.841</td>
      <td>3.363</td>
      <td>3.8860</td>
      <td>4.1990</td>
      <td>4.6758</td>
      <td>4.8800</td>
      <td>4.9394</td>
      <td>5.0000</td>
      <td>25</td>
      <td>8</td>
      <td>2014</td>
      <td>35</td>
      <td>0</td>
      <td>2014-08-26</td>
      <td>36</td>
    </tr>
    <tr>
      <th>290</th>
      <td>2014-08-26</td>
      <td>2.823</td>
      <td>3.318</td>
      <td>3.8760</td>
      <td>4.2000</td>
      <td>4.6695</td>
      <td>4.8730</td>
      <td>4.9363</td>
      <td>5.0000</td>
      <td>26</td>
      <td>8</td>
      <td>2014</td>
      <td>35</td>
      <td>1</td>
      <td>2014-08-27</td>
      <td>36</td>
    </tr>
    <tr>
      <th>291</th>
      <td>2014-08-27</td>
      <td>2.861</td>
      <td>3.349</td>
      <td>3.9828</td>
      <td>4.1780</td>
      <td>4.6680</td>
      <td>4.8729</td>
      <td>4.9365</td>
      <td>5.0000</td>
      <td>27</td>
      <td>8</td>
      <td>2014</td>
      <td>35</td>
      <td>2</td>
      <td>2014-08-28</td>
      <td>36</td>
    </tr>
    <tr>
      <th>292</th>
      <td>2014-08-28</td>
      <td>2.876</td>
      <td>3.538</td>
      <td>4.0500</td>
      <td>4.1330</td>
      <td>4.6689</td>
      <td>4.8727</td>
      <td>4.9373</td>
      <td>5.0000</td>
      <td>28</td>
      <td>8</td>
      <td>2014</td>
      <td>35</td>
      <td>3</td>
      <td>2014-08-29</td>
      <td>36</td>
    </tr>
    <tr>
      <th>293</th>
      <td>2014-08-29</td>
      <td>2.908</td>
      <td>3.672</td>
      <td>4.1990</td>
      <td>4.1140</td>
      <td>4.6659</td>
      <td>4.8726</td>
      <td>4.9364</td>
      <td>5.0000</td>
      <td>29</td>
      <td>8</td>
      <td>2014</td>
      <td>35</td>
      <td>4</td>
      <td>2014-08-30</td>
      <td>36</td>
    </tr>
  </tbody>
</table>
<p>294 rows × 16 columns</p>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出银行利率的时序图</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>,<span class="number">5</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> bank_features:</span><br><span class="line">    plt.plot(bank[<span class="string">'date'</span>], bank[[i]] ,label=i)</span><br><span class="line">    </span><br><span class="line">plt.legend()</span><br><span class="line">plt.title(<span class="string">"The time series of bank rate"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Rate"</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_128_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出部分银行利率与购买量的时序图</span></span><br><span class="line"></span><br><span class="line">fig,ax1 = plt.subplots(figsize=(<span class="number">15</span>,<span class="number">5</span>))</span><br><span class="line">plt.plot(bank[<span class="string">'date'</span>], bank[<span class="string">'Interest_3_M'</span>],<span class="string">'b'</span>,label=<span class="string">"Interest_3_M"</span>)</span><br><span class="line">plt.plot(bank[<span class="string">'date'</span>], bank[<span class="string">'Interest_6_M'</span>],<span class="string">'cyan'</span>,label=<span class="string">"Interest_6_M"</span>)</span><br><span class="line">plt.plot(bank[<span class="string">'date'</span>], bank[<span class="string">'Interest_9_M'</span>],<span class="string">'skyblue'</span>,label=<span class="string">"Interest_9_M"</span>)</span><br><span class="line"></span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">ax2=ax1.twinx()</span><br><span class="line">plt.plot(total_balance[<span class="string">'date'</span>], total_balance[<span class="string">'total_purchase_amt'</span>],<span class="string">'g'</span>,label=<span class="string">"Total purchase"</span>)</span><br><span class="line"></span><br><span class="line">plt.legend(loc=<span class="number">2</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of bank rate and purchase"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Rate & Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_129_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出部分银行利率与赎回量的时序图</span></span><br><span class="line"></span><br><span class="line">fig,ax1 = plt.subplots(figsize=(<span class="number">15</span>,<span class="number">5</span>))</span><br><span class="line">plt.plot(bank[<span class="string">'date'</span>], bank[<span class="string">'Interest_3_M'</span>],<span class="string">'b'</span>,label=<span class="string">"Interest_3_M"</span>)</span><br><span class="line">plt.plot(bank[<span class="string">'date'</span>], bank[<span class="string">'Interest_6_M'</span>],<span class="string">'cyan'</span>,label=<span class="string">"Interest_6_M"</span>)</span><br><span class="line">plt.plot(bank[<span class="string">'date'</span>], bank[<span class="string">'Interest_9_M'</span>],<span class="string">'skyblue'</span>,label=<span class="string">"Interest_9_M"</span>)</span><br><span class="line"></span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置次坐标轴</span></span><br><span class="line">ax2=ax1.twinx()</span><br><span class="line">plt.plot(total_balance[<span class="string">'date'</span>], total_balance[<span class="string">'total_redeem_amt'</span>],<span class="string">'g'</span>,label=<span class="string">"Total redeem"</span>)</span><br><span class="line"></span><br><span class="line">plt.legend(loc=<span class="number">2</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of bank rate and redeem"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Rate & Amount"</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_130_0.png" src="/img/loading.gif" class="lazyload"></p>
<p>收益率</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">share[<span class="string">'last_date'</span>] = share[<span class="string">'date'</span>] + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>))</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">temp = pd.merge(share[[<span class="string">'last_date'</span>]+share_features], total_balance, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_purchase_amt'</span>]+share_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>, vmin = <span class="number">0</span>)  </span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">temp = pd.merge(share[[<span class="string">'last_date'</span>]+share_features], total_balance, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_redeem_amt'</span>]+share_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>, vmin = <span class="number">0</span>)  </span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_132_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">share[<span class="string">'last_week'</span>] = share[<span class="string">'week'</span>] + <span class="number">1</span></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>))</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">temp = pd.merge(share[[<span class="string">'last_week'</span>,<span class="string">'weekday'</span>]+share_features], total_balance, left_on=[<span class="string">'last_week'</span>,<span class="string">'weekday'</span>], right_on=[<span class="string">'week'</span>,<span class="string">'weekday'</span>])[[<span class="string">'total_purchase_amt'</span>]+share_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>, vmin = <span class="number">0</span>)  </span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">temp = pd.merge(share[[<span class="string">'last_week'</span>,<span class="string">'weekday'</span>]+share_features], total_balance, left_on=[<span class="string">'last_week'</span>,<span class="string">'weekday'</span>], right_on=[<span class="string">'week'</span>,<span class="string">'weekday'</span>])[[<span class="string">'total_redeem_amt'</span>]+share_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>, vmin = <span class="number">0</span>) </span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_133_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">fig,ax1 = plt.subplots(figsize=(<span class="number">15</span>,<span class="number">5</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> share_features:</span><br><span class="line">    plt.plot(share[<span class="string">'date'</span>], share[i],<span class="string">'b'</span>,label=i)</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">plt.legend()</span><br><span class="line">ax2=ax1.twinx()</span><br><span class="line">plt.plot(total_balance[<span class="string">'date'</span>], total_balance[<span class="string">'total_purchase_amt'</span>],<span class="string">'g'</span>,label=<span class="string">"Total purchase"</span>)</span><br><span class="line">plt.legend(loc=<span class="number">2</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_134_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">fig,ax1 = plt.subplots(figsize=(<span class="number">15</span>,<span class="number">5</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> share_features:</span><br><span class="line">    plt.plot(share[<span class="string">'date'</span>], share[i],<span class="string">'b'</span>,label=i)</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">plt.legend()</span><br><span class="line">ax2=ax1.twinx()</span><br><span class="line">plt.plot(total_balance[<span class="string">'date'</span>], total_balance[<span class="string">'total_redeem_amt'</span>],<span class="string">'g'</span>,label=<span class="string">"Total redeem"</span>)</span><br><span class="line">plt.legend(loc=<span class="number">2</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_135_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出大额小额数据与**的相关性图</span></span><br><span class="line"></span><br><span class="line">share[<span class="string">'last_date'</span>] = share[<span class="string">'date'</span>] + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>))</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">temp = pd.merge(share[[<span class="string">'last_date'</span>]+share_features], small_purchase, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_purchase_amt'</span>]+share_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>, vmin=<span class="number">0</span>)  </span><br><span class="line">plt.title(<span class="string">"SMALL PURCHASE"</span>)</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">plt.title(<span class="string">"SMALL REDEEM"</span>)</span><br><span class="line">temp = pd.merge(share[[<span class="string">'last_date'</span>]+share_features], small_redeem, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_redeem_amt'</span>]+share_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>, vmin=<span class="number">0</span>)  </span><br><span class="line"></span><br><span class="line">share[<span class="string">'last_date'</span>] = share[<span class="string">'date'</span>] + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">4</span>))</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">"BIG PURCHASE"</span>)</span><br><span class="line">temp = pd.merge(share[[<span class="string">'last_date'</span>]+share_features], big_purchase, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_purchase_amt'</span>]+share_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>, vmin=<span class="number">0</span>)  </span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">plt.title(<span class="string">"BIG REDEEM"</span>)</span><br><span class="line">temp = pd.merge(share[[<span class="string">'last_date'</span>]+share_features], big_redeem, left_on=<span class="string">'last_date'</span>, right_on=<span class="string">'date'</span>)[[<span class="string">'total_redeem_amt'</span>]+share_features]</span><br><span class="line">sns.heatmap(temp.corr(), linewidths = <span class="number">0.05</span>, vmin=<span class="number">0</span>)  </span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_136_0.png" src="/img/loading.gif" class="lazyload"></p>
<p><img alt data-src="/images/output_136_1.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">fig,ax1 = plt.subplots(figsize=(<span class="number">15</span>,<span class="number">5</span>))</span><br><span class="line">plt.plot(bank[<span class="string">'date'</span>], bank[<span class="string">'Interest_3_M'</span>],c=<span class="string">'g'</span>,label= <span class="string">'BANK'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">ax2=ax1.twinx()</span><br><span class="line">plt.plot(share[<span class="string">'date'</span>], share[<span class="string">'mfd_daily_yield'</span>],label=<span class="string">'SHARE'</span>)</span><br><span class="line">plt.legend(loc=<span class="number">2</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_137_0.png" src="/img/loading.gif" class="lazyload"></p>
<ul>
<li>支付宝收益率对购买力的影响看起来更为显著</li>
<li>银行利率对赎回影响看起来更为显著</li>
<li>银行利率的影响是长期的，支付宝收益率的影响是短期的</li>
</ul>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><strong>相关因素</strong></p>
<ul>
<li>是否工作日、周几</li>
<li>是否假期</li>
<li>是否月初或月末</li>
<li>距离周一、日的天数，距离节假日的天数、距离月初、月末的天数</li>
</ul>
<h3 id="分析用户信息"><a href="#分析用户信息" class="headerlink" title="分析用户信息"></a>分析用户信息</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Load the balance data</span></span><br><span class="line">data_balance = pd.read_csv(dataset_path+<span class="string">"user_balance_table.csv"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add tiemstamp to dataset</span></span><br><span class="line">data_balance[<span class="string">'date'</span>] = pd.to_datetime(data_balance[<span class="string">'report_date'</span>], format= <span class="string">"%Y%m%d"</span>)</span><br><span class="line">data_balance[<span class="string">'day'</span>] = data_balance[<span class="string">'date'</span>].dt.day</span><br><span class="line">data_balance[<span class="string">'month'</span>] = data_balance[<span class="string">'date'</span>].dt.month</span><br><span class="line">data_balance[<span class="string">'year'</span>] = data_balance[<span class="string">'date'</span>].dt.year</span><br><span class="line">data_balance[<span class="string">'week'</span>] = data_balance[<span class="string">'date'</span>].dt.week</span><br><span class="line">data_balance[<span class="string">'weekday'</span>] = data_balance[<span class="string">'date'</span>].dt.weekday</span><br><span class="line"></span><br><span class="line"><span class="comment"># total amount</span></span><br><span class="line"><span class="comment"># 计算每天的总交易额</span></span><br><span class="line">total_balance = data_balance.groupby([<span class="string">'date'</span>])[<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>].sum()</span><br><span class="line">total_balance.reset_index(inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add time stamp</span></span><br><span class="line">total_balance[<span class="string">'day'</span>] = total_balance[<span class="string">'date'</span>].dt.day</span><br><span class="line">total_balance[<span class="string">'month'</span>] = total_balance[<span class="string">'date'</span>].dt.month</span><br><span class="line">total_balance[<span class="string">'year'</span>] = total_balance[<span class="string">'date'</span>].dt.year</span><br><span class="line">total_balance[<span class="string">'week'</span>] = total_balance[<span class="string">'date'</span>].dt.week</span><br><span class="line">total_balance[<span class="string">'weekday'</span>] = total_balance[<span class="string">'date'</span>].dt.weekday</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load user's information</span></span><br><span class="line">users = pd.read_csv(dataset_path+<span class="string">'user_profile_table.csv'</span>)</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="分析大小额用户"><a href="#分析大小额用户" class="headerlink" title="分析大小额用户"></a>分析大小额用户</h4><p>前面的分析可以看出，某些用户的交易额很大，对于日交易量很明显，这里统计四月份后依旧活跃的大额用户(大于100万)</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 获得大额用户集合</span></span><br><span class="line">temp = data_balance[(data_balance[<span class="string">'total_purchase_amt'</span>] >= <span class="number">1000000</span>) | (data_balance[<span class="string">'total_redeem_amt'</span>] >= <span class="number">1000000</span>)]</span><br><span class="line">big_users_set = set(temp[temp[<span class="string">'date'</span>] >= datetime.datetime(<span class="number">2014</span>,<span class="number">4</span>,<span class="number">1</span>)][<span class="string">'user_id'</span>])</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">len(big_users_set)</span><br></pre></td></tr></tbody></table></figure></div>


<pre><code>3903</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">len(big_users_set)/len(set(data_balance[<span class="string">'user_id'</span>]))</span><br></pre></td></tr></tbody></table></figure></div>


<pre><code>0.13918904461324488</code></pre><p>大额用户占3903个，约占总数的13%</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 标记大额用户</span></span><br><span class="line">data_balance[<span class="string">'big_user'</span>] = <span class="number">0</span></span><br><span class="line">data_balance.loc[data_balance[<span class="string">'user_id'</span>].isin(big_users_set), <span class="string">'big_user'</span>] = <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 统计大额用户与小额用户的日总交易额</span></span><br><span class="line">total_balance_bigNsmall = data_balance.groupby([<span class="string">'date'</span>,<span class="string">'big_user'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>].sum()</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">total_balance_bigNsmall.head(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>big_user</th>
      <th>total_purchase_amt</th>
      <th>total_redeem_amt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-07-01</td>
      <td>0</td>
      <td>4801182</td>
      <td>925236</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-07-01</td>
      <td>1</td>
      <td>27687166</td>
      <td>4599786</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-07-02</td>
      <td>0</td>
      <td>6692332</td>
      <td>1944664</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-07-02</td>
      <td>1</td>
      <td>22345058</td>
      <td>609884</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-07-03</td>
      <td>0</td>
      <td>7027919</td>
      <td>1273803</td>
    </tr>
  </tbody>
</table>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出大额用户与小额用户交易的日总交易量图</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">20</span>,<span class="number">8</span>))</span><br><span class="line">plt.plot(total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">1</span>][<span class="string">'date'</span>], total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">1</span>][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'big_purchase'</span>)</span><br><span class="line">plt.plot(total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">1</span>][<span class="string">'date'</span>], total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">1</span>][<span class="string">'total_redeem_amt'</span>],label=<span class="string">'big_redeem'</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">0</span>][<span class="string">'date'</span>], total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">0</span>][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'small_purchase'</span>)</span><br><span class="line">plt.plot(total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">0</span>][<span class="string">'date'</span>], total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">0</span>][<span class="string">'total_redeem_amt'</span>],label=<span class="string">'small_redeem'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of big and small user of Purchase and Redeem"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_151_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 统计大额小额用户购买量占比</span></span><br><span class="line"></span><br><span class="line">np.sum(total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">1</span>][<span class="string">'total_purchase_amt'</span>]) / np.sum(total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">0</span>][<span class="string">'total_purchase_amt'</span>])</span><br></pre></td></tr></tbody></table></figure></div>


<pre><code>5.1456178397775805</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 统计大额小额用户赎回量占比</span></span><br><span class="line"></span><br><span class="line">np.sum(total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">1</span>][<span class="string">'total_redeem_amt'</span>]) / np.sum(total_balance_bigNsmall[total_balance_bigNsmall[<span class="string">'big_user'</span>] == <span class="number">0</span>][<span class="string">'total_redeem_amt'</span>])</span><br></pre></td></tr></tbody></table></figure></div>


<pre><code>5.422141272341089</code></pre><h4 id="分析用户交易频次"><a href="#分析用户交易频次" class="headerlink" title="分析用户交易频次"></a>分析用户交易频次</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出非0交易的频次分布图</span></span><br><span class="line">frequency = data_balance[(data_balance[<span class="string">'direct_purchase_amt'</span>] != <span class="number">0</span>) | (data_balance[<span class="string">'total_redeem_amt'</span>] != <span class="number">0</span>)][[<span class="string">'user_id'</span>,<span class="string">'tBalance'</span>]].groupby(<span class="string">'user_id'</span>, as_index=<span class="literal">False</span>).count()</span><br><span class="line">sns.distplot(frequency[<span class="string">'tBalance'</span>])</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_155_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 获取频繁交易用户集合</span></span><br><span class="line">hot_users_set = set(frequency[frequency[<span class="string">'tBalance'</span>] > <span class="number">30</span>][<span class="string">'user_id'</span>])</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 标记频繁交易用户</span></span><br><span class="line">data_balance[<span class="string">'is_hot_users'</span>] = <span class="number">0</span></span><br><span class="line">data_balance.loc[data_balance[<span class="string">'user_id'</span>].isin(hot_users_set) , <span class="string">'is_hot_users'</span>] = <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 统计频繁用户与非频繁用户的日总交易额</span></span><br><span class="line">total_balance_hotNcold = data_balance.groupby([<span class="string">'date'</span>,<span class="string">'is_hot_users'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>].sum()</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#绘制频繁用户与非频繁用户总购买赎回量的时序图</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">20</span>,<span class="number">8</span>))</span><br><span class="line">plt.plot(total_balance_hotNcold[total_balance_hotNcold[<span class="string">'is_hot_users'</span>] == <span class="number">1</span>][<span class="string">'date'</span>], total_balance_hotNcold[total_balance_hotNcold[<span class="string">'is_hot_users'</span>] == <span class="number">1</span>][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'hot_purchase'</span>)</span><br><span class="line">plt.plot(total_balance_hotNcold[total_balance_hotNcold[<span class="string">'is_hot_users'</span>] == <span class="number">1</span>][<span class="string">'date'</span>], total_balance_hotNcold[total_balance_hotNcold[<span class="string">'is_hot_users'</span>] == <span class="number">1</span>][<span class="string">'total_redeem_amt'</span>],label=<span class="string">'hot_redeem'</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(total_balance_hotNcold[total_balance_hotNcold[<span class="string">'is_hot_users'</span>] == <span class="number">0</span>][<span class="string">'date'</span>], total_balance_hotNcold[total_balance_hotNcold[<span class="string">'is_hot_users'</span>] == <span class="number">0</span>][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'cold_purchase'</span>)</span><br><span class="line">plt.plot(total_balance_hotNcold[total_balance_hotNcold[<span class="string">'is_hot_users'</span>] == <span class="number">0</span>][<span class="string">'date'</span>], total_balance_hotNcold[total_balance_hotNcold[<span class="string">'is_hot_users'</span>] == <span class="number">0</span>][<span class="string">'total_redeem_amt'</span>],label=<span class="string">'cold_redeem'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of big and small user of Purchase and Redeem"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_159_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出冷启动用户与老用户交易的箱型图</span></span><br><span class="line"></span><br><span class="line">temp = data_balance[[<span class="string">'year'</span>,<span class="string">'month'</span>,<span class="string">'user_id'</span>,<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>]].groupby([<span class="string">'year'</span>,<span class="string">'month'</span>,<span class="string">'user_id'</span>], as_index=<span class="literal">False</span>).sum()</span><br><span class="line">user_old_set = set()</span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">30</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">9</span>):</span><br><span class="line">    newset = set(temp[(temp[<span class="string">'year'</span>] == <span class="number">2014</span>) & (temp[<span class="string">'month'</span>] == i)][<span class="string">'user_id'</span>])</span><br><span class="line">    this_month = data_balance[(data_balance[<span class="string">'year'</span>] == <span class="number">2014</span>) & (data_balance[<span class="string">'month'</span>] == i)]</span><br><span class="line">    this_month[<span class="string">'cold'</span>] = <span class="number">0</span></span><br><span class="line">    this_month.loc[this_month[<span class="string">'user_id'</span>].isin(newset - user_old_set), <span class="string">'cold'</span>] = <span class="number">1</span></span><br><span class="line">    plt.subplot(<span class="number">4</span>,<span class="number">2</span>,i)</span><br><span class="line">    plt.title(<span class="string">'This month : '</span> + str(i))</span><br><span class="line">    sns.boxplot(x=<span class="string">"cold"</span>, y=<span class="string">"total_purchase_amt"</span> , data=this_month[(this_month[<span class="string">'direct_purchase_amt'</span>] != <span class="number">0</span>) | (this_month[<span class="string">'total_redeem_amt'</span>] != <span class="number">0</span>)])</span><br><span class="line">    user_old_set = user_old_set | newset</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_160_0.png" src="/img/loading.gif" class="lazyload"></p>
<h4 id="用户其他属性"><a href="#用户其他属性" class="headerlink" title="用户其他属性"></a>用户其他属性</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">users.head(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>sex</th>
      <th>city</th>
      <th>constellation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>1</td>
      <td>6411949</td>
      <td>狮子座</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12</td>
      <td>1</td>
      <td>6412149</td>
      <td>摩羯座</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22</td>
      <td>1</td>
      <td>6411949</td>
      <td>双子座</td>
    </tr>
    <tr>
      <th>3</th>
      <td>23</td>
      <td>1</td>
      <td>6411949</td>
      <td>双鱼座</td>
    </tr>
    <tr>
      <th>4</th>
      <td>25</td>
      <td>1</td>
      <td>6481949</td>
      <td>双鱼座</td>
    </tr>
  </tbody>
</table>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 添加城市、星座、性别</span></span><br><span class="line">data_balance = pd.merge(data_balance, users, on=<span class="string">'user_id'</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data_balance.head(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>report_date</th>
      <th>tBalance</th>
      <th>yBalance</th>
      <th>total_purchase_amt</th>
      <th>direct_purchase_amt</th>
      <th>purchase_bal_amt</th>
      <th>purchase_bank_amt</th>
      <th>total_redeem_amt</th>
      <th>consume_amt</th>
      <th>...</th>
      <th>day</th>
      <th>month</th>
      <th>year</th>
      <th>week</th>
      <th>weekday</th>
      <th>big_user</th>
      <th>is_hot_users</th>
      <th>sex</th>
      <th>city</th>
      <th>constellation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>20140805</td>
      <td>20385</td>
      <td>20383</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>5</td>
      <td>8</td>
      <td>2014</td>
      <td>32</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>6411949</td>
      <td>白羊座</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>20140808</td>
      <td>20391</td>
      <td>20389</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>8</td>
      <td>8</td>
      <td>2014</td>
      <td>32</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>6411949</td>
      <td>白羊座</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>20140811</td>
      <td>20397</td>
      <td>20395</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>11</td>
      <td>8</td>
      <td>2014</td>
      <td>33</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>6411949</td>
      <td>白羊座</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>20140814</td>
      <td>20403</td>
      <td>20401</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>14</td>
      <td>8</td>
      <td>2014</td>
      <td>33</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>6411949</td>
      <td>白羊座</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>20140817</td>
      <td>20409</td>
      <td>20407</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>17</td>
      <td>8</td>
      <td>2014</td>
      <td>33</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>6411949</td>
      <td>白羊座</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 29 columns</p>

</div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 统计每个城市用户的日总交易额的区别并绘制分布估计图</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>,<span class="number">5</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.unique(data_balance[<span class="string">'city'</span>]):</span><br><span class="line">    temp = data_balance.groupby([<span class="string">'date'</span>,<span class="string">'city'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>].sum()</span><br><span class="line">    ax = sns.kdeplot( temp[temp[<span class="string">'city'</span>] == i][<span class="string">'total_purchase_amt'</span>],label=i)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of different city of Purchase and Redeem"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>,<span class="number">5</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.unique(data_balance[<span class="string">'city'</span>]):</span><br><span class="line">    temp = data_balance.groupby([<span class="string">'date'</span>,<span class="string">'city'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>].sum()</span><br><span class="line">    ax = sns.kdeplot( temp[temp[<span class="string">'city'</span>] == i][<span class="string">'total_redeem_amt'</span>],label=i)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of different city of Purchase and Redeem"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_165_0.png" src="/img/loading.gif" class="lazyload"></p>
<p><img alt data-src="/images/output_165_1.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 统计每个性别用户的日总交易额的区别，并绘制时序图</span></span><br><span class="line"></span><br><span class="line">temp = data_balance.groupby([<span class="string">'date'</span>,<span class="string">'sex'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>].sum()</span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">20</span>,<span class="number">6</span>))</span><br><span class="line">plt.plot(temp[temp[<span class="string">'sex'</span>] == <span class="number">1</span>][<span class="string">'date'</span>], temp[temp[<span class="string">'sex'</span>] == <span class="number">1</span>][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'Male'</span>)</span><br><span class="line">plt.plot(temp[temp[<span class="string">'sex'</span>] == <span class="number">0</span>][<span class="string">'date'</span>], temp[temp[<span class="string">'sex'</span>] == <span class="number">0</span>][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'Female'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of two gender user of Purchase"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">20</span>,<span class="number">6</span>))</span><br><span class="line">plt.plot(temp[temp[<span class="string">'sex'</span>] == <span class="number">1</span>][<span class="string">'date'</span>], temp[temp[<span class="string">'sex'</span>] == <span class="number">1</span>][<span class="string">'total_purchase_amt'</span>],label=<span class="string">'Male'</span>)</span><br><span class="line">plt.plot(temp[temp[<span class="string">'sex'</span>] == <span class="number">0</span>][<span class="string">'date'</span>], temp[temp[<span class="string">'sex'</span>] == <span class="number">0</span>][<span class="string">'total_redeem_amt'</span>],label=<span class="string">'Female'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of two gender user of Redeem"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_166_0.png" src="/img/loading.gif" class="lazyload"></p>
<p><img alt data-src="/images/output_166_1.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 统计每个星座用户的日总交易额的区别 并绘制分布估计图</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>,<span class="number">5</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.unique(data_balance[<span class="string">'constellation'</span>]):</span><br><span class="line">    temp = data_balance.groupby([<span class="string">'date'</span>,<span class="string">'constellation'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>].sum()</span><br><span class="line">    ax = sns.kdeplot( temp[temp[<span class="string">'constellation'</span>] == i][<span class="string">'total_purchase_amt'</span>],label=i)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of small deal of Purchase and Redeem"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>,<span class="number">5</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.unique(data_balance[<span class="string">'constellation'</span>]):</span><br><span class="line">    temp = data_balance.groupby([<span class="string">'date'</span>,<span class="string">'constellation'</span>], as_index=<span class="literal">False</span>)[<span class="string">'total_purchase_amt'</span>,<span class="string">'total_redeem_amt'</span>].sum()</span><br><span class="line">    ax = sns.kdeplot( temp[temp[<span class="string">'constellation'</span>] == i][<span class="string">'total_redeem_amt'</span>],label=i)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The time series of small deal of Purchase and Redeem"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_167_0.png" src="/img/loading.gif" class="lazyload"></p>
<p><img alt data-src="/images/output_167_1.png" src="/img/loading.gif" class="lazyload"></p>
<h3 id="其他分析"><a href="#其他分析" class="headerlink" title="其他分析"></a>其他分析</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出每日利息的增长/直接购买量的时序图</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">20</span>,<span class="number">6</span>))</span><br><span class="line">plt.plot(temp[<span class="string">'date'</span>],  temp[<span class="string">'share_amt'</span>] / temp[<span class="string">'direct_purchase_amt'</span>] ,label=<span class="string">'Rate'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The rate of Share / Purchase"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/2020/08/20/2020-08-20-%E8%B5%84%E9%87%91%E6%B5%81%E5%85%A5%E6%B5%81%E5%87%BA%E9%A2%84%E6%B5%8B%EF%BC%88task1%EF%BC%89/imagesoutput_169_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 加载支付宝利率数据</span></span><br><span class="line"></span><br><span class="line">share = pd.read_csv(dataset_path+<span class="string">'mfd_day_share_interest.csv'</span>)</span><br><span class="line">share = share.rename(columns = {<span class="string">'mfd_date'</span>: <span class="string">'date'</span>})</span><br><span class="line">share_features = [x <span class="keyword">for</span> x <span class="keyword">in</span> share.columns <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'date'</span>]]</span><br><span class="line">share[<span class="string">'date'</span>] = pd.to_datetime(share[<span class="string">'date'</span>], format= <span class="string">"%Y%m%d"</span>)</span><br><span class="line">share[<span class="string">'day'</span>] = share[<span class="string">'date'</span>].dt.day</span><br><span class="line">share[<span class="string">'month'</span>] = share[<span class="string">'date'</span>].dt.month</span><br><span class="line">share[<span class="string">'year'</span>] = share[<span class="string">'date'</span>].dt.year</span><br><span class="line">share[<span class="string">'week'</span>] = share[<span class="string">'date'</span>].dt.week</span><br><span class="line">share[<span class="string">'weekday'</span>] = share[<span class="string">'date'</span>].dt.weekday</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 绘制支付宝利率与交易额的时序图</span></span><br><span class="line"></span><br><span class="line">fig,ax1 = plt.subplots(figsize=(<span class="number">15</span>,<span class="number">5</span>))</span><br><span class="line">plt.plot(temp[<span class="string">'date'</span>], temp[<span class="string">'share_amt'</span>],<span class="string">'b'</span>,label=<span class="string">"Share_amt"</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">ax2=ax1.twinx()</span><br><span class="line">plt.plot(share[<span class="string">'date'</span>], share[<span class="string">'mfd_daily_yield'</span>],<span class="string">'g'</span>,label=<span class="string">"Share rate"</span>)</span><br><span class="line"></span><br><span class="line">plt.legend(loc=<span class="number">2</span>)</span><br><span class="line">plt.title(<span class="string">"The correlation between share rate and share amount"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Rate & Amount"</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_171_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 支付宝利率与每日利息的增长/直接购买量的时序图</span></span><br><span class="line"></span><br><span class="line">fig,ax1 = plt.subplots(figsize=(<span class="number">15</span>,<span class="number">5</span>))</span><br><span class="line">plt.plot(temp[<span class="string">'date'</span>], temp[<span class="string">'share_amt'</span>] / temp[<span class="string">'direct_purchase_amt'</span>],<span class="string">'b'</span>,label=<span class="string">"Share_amt / Direct_amt"</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">ax2=ax1.twinx()</span><br><span class="line">plt.plot(share[<span class="string">'date'</span>], share[<span class="string">'mfd_daily_yield'</span>],<span class="string">'g'</span>,label=<span class="string">"Share rate"</span>)</span><br><span class="line"></span><br><span class="line">plt.legend(loc=<span class="number">2</span>)</span><br><span class="line">plt.title(<span class="string">"The correlation between share rate and Share/Purchase"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Rate & Amount"</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_172_0.png" src="/img/loading.gif" class="lazyload"></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 聚合两种不同购买方式</span></span><br><span class="line"></span><br><span class="line">temp = data_balance.groupby([<span class="string">'date'</span>], as_index=<span class="literal">False</span>)[<span class="string">'purchase_bal_amt'</span>,<span class="string">'purchase_bank_amt'</span>].sum()</span><br></pre></td></tr></tbody></table></figure></div>


<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 画出不同购买方式日购买量的时序图</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">20</span>,<span class="number">6</span>))</span><br><span class="line">plt.plot(temp[<span class="string">'date'</span>], temp[<span class="string">'purchase_bal_amt'</span>],label=<span class="string">'Bal'</span>)</span><br><span class="line">plt.plot(temp[<span class="string">'date'</span>], temp[<span class="string">'purchase_bank_amt'</span>],label=<span class="string">'Bank'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.title(<span class="string">"The purchase of bal and bank"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Time"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Amount"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure></div>


<p><img alt data-src="/images/output_174_0.png" src="/img/loading.gif" class="lazyload"></p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><ul>
<li>[violinplot] 小提琴图，分析数据分布</li>
<li>[distplot] 直方图+概率曲线</li>
<li>[kdeplot] 概率密度图，分析序列趋势</li>
<li>[lineplot] 折线图，分析趋势</li>
<li>[barplot] 柱状图，分析趋势</li>
<li>[boxplot] 分析异常值点</li>
<li>[heatmap] 热力图，找到异常值</li>
</ul>
</body></html></div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98%E5%AE%9E%E8%B7%B5/">数据挖掘实践    </a><a class="post-meta__tags" href="/tags/%E6%97%B6%E5%BA%8F/">时序    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/08/22/2020-08-22-%E7%88%AC%E8%99%AB1&amp;2%EF%BC%88%E5%B0%8F%E8%AF%B4%E4%B8%8B%E8%BD%BD%EF%BC%89/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>爬虫1&amp;2（小说下载）</span></div></a></div><div class="next-post pull_right"><a href="/2020/03/03/2020-03-03-unit6/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>神经网络</span></div></a></div></nav></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Iyin</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script id="canvas_nest" color="189,207,69" opacity="0.9" zIndex="-1" count="70" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>